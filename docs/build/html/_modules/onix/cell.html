

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>onix.cell &mdash; ONIX Documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #0d0d0d" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releasenotes/index.html">Release Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pythonapi/index.html">Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License Agreement</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ONIX</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>onix.cell</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for onix.cell</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">.sequence</span> <span class="kn">import</span> <span class="n">Sequence</span> <span class="k">as</span> <span class="n">seq</span>
<span class="kn">from</span> <span class="nn">.passlist</span> <span class="kn">import</span> <span class="n">Passlist</span> <span class="k">as</span> <span class="n">pl</span>
<span class="kn">from</span> <span class="nn">.passport</span> <span class="kn">import</span> <span class="n">Passport</span> <span class="k">as</span> <span class="n">pp</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">data</span>
<span class="kn">import</span> <span class="nn">onix.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">operator</span>
<span class="kn">import</span> <span class="nn">time</span>



<div class="viewcode-block" id="Cell"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell">[docs]</a><span class="k">class</span> <span class="nc">Cell</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Cells (or BUCells), represent burnup regions and contain a unique onix.Passlist object with a specific list of nuclides.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cell_id: int</span>
<span class="sd">        The id number of the BUCell</span>
<span class="sd">    name: str</span>
<span class="sd">        The name of the BUCell</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_NA</span> <span class="o">=</span> <span class="mf">6.02214086e+23</span>
    <span class="n">zero_dens_1_atm</span> <span class="o">=</span> <span class="mf">1E-24</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cell_id</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_id</span> <span class="o">=</span> <span class="n">cell_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_passlist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_nucl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_b_lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_MC_XS_nucl_list</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nucl_set</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># self._MC_flux = None</span>
        <span class="c1"># self._MC_flux_seq = None</span>
        <span class="c1"># self._flux = None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_FMF</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_output_summary_path</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Mainly designed for the code. Used when the user use text input rather than python module</span>
    <span class="c1"># probably obsolete</span>
    <span class="c1"># def set_from_input(self, input):</span>

    <span class="c1">#   cell_id = self._cell_id</span>
    <span class="c1">#   self._vol = input.vol(cell_id)</span>
    <span class="c1">#   self._hm_vol = input.hm_vol(cell_id)</span>
    <span class="c1">#   self._initial_nuc = input.initial_nuc(cell_id)</span>

    <span class="c1">#   self._nuc_list = input.nucl_list</span>
    <span class="c1">#   self._passlist = pl.gen_passlist_from_input(input, cell_id)</span>
    <span class="c1">#   self._passdic = pl.passlist_to_passdic(self._passlist)</span>
    <span class="c1">#   self._index_dic = pl.index_dic(self._passlist)</span>

    <span class="c1">#   # Generate the list of fission child for each fissile nuclide</span>
    <span class="c1">#   pl.gen_fission_child(self._passdic, input)</span>

    <span class="c1">#   self.set_ihm(self._passlist, self._hm_vol)</span>
    <span class="c1">#   self.set_bu_sec_conv_factor(self._vol, self._ihm)</span>

    <span class="c1">#   self.link_sequence_from_input(input, cell_id, self._bu_sec_conv_factor)</span>

    <span class="c1">#   self._set_tree()</span>
    <span class="c1">#   self._set_leaves()</span>
    <span class="c1">#   fy_parent = input.fy_parent</span>
    <span class="c1">#   self._set_fission_tree()</span>
    <span class="c1">#   self._set_fission_leaves()</span>
    <span class="c1">#   self._fission_tree = self.build_fission_tree(self._tree, fy_parent)</span>
    <span class="c1">#   self._fission_leaves = self.build_fission_leaves()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns number id of BUCell&quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns name of BUCell&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>



    <span class="c1"># Set the initial densities to nuclides and create the initial nuc list</span>
<div class="viewcode-block" id="Cell.set_initial_dens"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_initial_dens">[docs]</a>    <span class="k">def</span> <span class="nf">set_initial_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dens_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the initial densities of nuclides in :math:`10^{24}cm^{-3}`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dens_dict: dict</span>
<span class="sd">            A dictionnary where keys are nuclides&#39; names and entries are densities in :math:`10^{24}cm^{-3}`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dens_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_name</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">nucl_list</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">name_list_to_zamid_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>


        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passlist</span><span class="o">.</span><span class="n">_set_initial_dens</span><span class="p">(</span><span class="n">dens_dict</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_nucl</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_check_nucl_list_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="c1"># Return lib_nucl and will also stop code if there are no decay/xs libs set</span>
        <span class="n">lib_nucl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_lib_nucl</span><span class="p">()</span>
        <span class="c1"># If no nucl_set set, nucl_set is set to default to lib_nucl</span>
        <span class="c1"># If nucl_set set, check if it is included in lib_nucl</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucl_set</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nucl_set</span> <span class="o">=</span> <span class="n">lib_nucl</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_lista_in_listb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nucl_set</span><span class="p">,</span> <span class="n">lib_nucl</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Nucl_set_not_in_Lib_nucl</span><span class="p">(</span><span class="s1">&#39;Some of bucell </span><span class="si">{}</span><span class="s1"> nuclide-set&quot;s nuclides are not in data libraries&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

        <span class="n">initial_nucl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_nucl</span>

        <span class="n">nucl_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucl_set</span>

        <span class="k">if</span> <span class="n">initial_nucl</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Initial_nucl_not_set</span><span class="p">(</span><span class="s1">&#39;Cell </span><span class="si">{}</span><span class="s1"> has not been attributed initial nuclides&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_lista_in_listb</span><span class="p">(</span><span class="n">initial_nucl</span><span class="p">,</span> <span class="n">nucl_set</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Initial_nucl_not_in_Nucl_set</span><span class="p">(</span><span class="s1">&#39;Some of bucell </span><span class="si">{}</span><span class="s1"> initial nuclides </span><span class="si">{}</span><span class="s1"> are not in nuclide set&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">initial_nucl</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_step_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">passport_list</span><span class="p">)):</span>
            <span class="n">nuc_pass</span> <span class="o">=</span> <span class="n">passport_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nuc_pass</span><span class="o">.</span><span class="n">_set_step_dens</span><span class="p">()</span>

    <span class="c1"># This is effectively set_substep_dens</span>
    <span class="k">def</span> <span class="nf">_update_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">ssn</span><span class="p">):</span>

        <span class="c1"># Technically I don&#39;t need to use N_dic since passport_list</span>
        <span class="c1"># is actually automatically ordered in the same way as N via mb</span>
        <span class="c1"># (the argument passport_list is a pointer to the object, not a copy of the object)</span>
        <span class="c1"># You need to be sure that N and passport_list are ordered in the same</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">passport_list</span><span class="p">)):</span>
            <span class="n">nuc_pass</span> <span class="o">=</span> <span class="n">passport_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nuc_pass</span><span class="o">.</span><span class="n">_set_substep_dens</span><span class="p">(</span><span class="n">N</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ss</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">initial_nucl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the initial list of nuclides.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_nucl</span>

    <span class="k">def</span> <span class="nf">_set_initial_nucl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_id_list</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>

        <span class="c1"># Here a copy is made because the list nucl_id_list is latter</span>
        <span class="c1"># modified by other functions (set_default_decay and others)</span>
        <span class="c1"># This will accidentally modify initial_nucl if it is simply equalled to nucl_id_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_nucl</span> <span class="o">=</span> <span class="n">nucl_id_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># These two functions are probably useless now</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">MC_XS_nucl_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_MC_XS_nucl_list</span>

    <span class="nd">@MC_XS_nucl_list</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">MC_XS_nucl_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">MC_XS_nucl_list</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_MC_XS_nucl_list</span> <span class="o">=</span> <span class="n">MC_XS_nucl_list</span>
    
    <span class="c1"># These two functions are probably useless now</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nucl_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nucl_set</span>

    <span class="nd">@nucl_set</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">nucl_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_set</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_nucl_set</span> <span class="o">=</span> <span class="n">nucl_set</span>

    <span class="c1"># This property is just to know which nuclides</span>
    <span class="c1"># are initially present (dens non-0) in the cell</span>
    <span class="c1"># These two functions are probably useless now</span>
    <span class="c1"># @property</span>
    <span class="c1"># def init_nucl(self):</span>

    <span class="c1">#   return self._init_nucl</span>

    <span class="c1"># @init_nucl.setter</span>
    <span class="c1"># def init_nucl(self, init_nucl):</span>

    <span class="c1">#   self._init_nucl = init_nucl</span>
    

<div class="viewcode-block" id="Cell.get_total_dens"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_total_dens">[docs]</a>    <span class="k">def</span> <span class="nf">get_total_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the total density of all nuclides in the BUCell in :math:`10^{24}cm^{-3}`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">total_dens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="k">for</span> <span class="n">nuc_pass</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="n">total_dens</span> <span class="o">+=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span>

        <span class="k">return</span> <span class="n">total_dens</span></div>

<div class="viewcode-block" id="Cell.get_subtotal_dens"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_subtotal_dens">[docs]</a>    <span class="k">def</span> <span class="nf">get_subtotal_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the total density of sub-set of nuclides in the BUCell in :math:`10^{24}cm^{-3}`.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nucl_list: list</span>
<span class="sd">            A list of nuclides&#39; names</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">subtotal_dens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="k">for</span> <span class="n">nuc_pass</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">nucl_list</span><span class="p">:</span>

                <span class="n">subtotal_dens</span> <span class="o">+=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span>

        <span class="k">return</span> <span class="n">subtotal_dens</span></div>

    <span class="c1"># This version of the method counts zero dens atom as 1E-24. It is used</span>
    <span class="c1"># when computing the density of material for OpenMC</span>
    <span class="k">def</span> <span class="nf">_get_subtotal_dens_counting_zero_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_list</span><span class="p">):</span>

        <span class="n">subtotal_dens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="k">for</span> <span class="n">nuc_pass</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">nucl_list</span><span class="p">:</span>

                <span class="c1"># following is a possible solution to the xs drop problem</span>
                <span class="c1"># nuclide that are zero in onix and supposed to be tallied</span>
                <span class="c1"># are actually set to 1E-24 in openmc</span>
                <span class="c1"># therefore, we count them as 1E-24 not zero</span>

                <span class="k">if</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_dens_1_atm</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span>

                <span class="n">subtotal_dens</span> <span class="o">+=</span> <span class="n">dens</span>

                <span class="c1">#subtotal_dens += nuc_pass.current_dens</span>


        <span class="k">return</span> <span class="n">subtotal_dens</span>

    <span class="c1"># Gets nuclides&#39; densities for openmc materials object</span>
    <span class="c1"># Densities which are set to 0 in onix (because below threeshold) should still have one atom to allow openmc to calculate cross sections</span>
    <span class="k">def</span> <span class="nf">_get_nucl_dens_for_openmc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_id</span><span class="p">):</span>

        <span class="n">nucl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nuclide</span><span class="p">(</span><span class="n">nucl_id</span><span class="p">)</span>
        <span class="n">nucl_dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">current_dens</span>

        <span class="k">if</span> <span class="n">nucl_dens</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_dens_1_atm</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">nucl_dens</span>

<div class="viewcode-block" id="Cell.get_nucl_ao"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_nucl_ao">[docs]</a>    <span class="k">def</span> <span class="nf">get_nucl_ao</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the atom fraction of a nuclide over the total number of atoms in the BUCell.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nucl_id: str</span>
<span class="sd">            The z-a-m id or the name of the nuclide</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nucl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nuclide</span><span class="p">(</span><span class="n">nucl_id</span><span class="p">)</span>
        <span class="n">nucl_dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">current_dens</span>
        <span class="n">total_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_dens</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">nucl_dens</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="n">total_dens</span></div>

<div class="viewcode-block" id="Cell.get_nucl_subao"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_nucl_subao">[docs]</a>    <span class="k">def</span> <span class="nf">get_nucl_subao</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_id</span><span class="p">,</span> <span class="n">nucl_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the atom fraction of a nuclide over the number of atoms of a sub-set of nuclides in the BUCell.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nucl_id: str</span>
<span class="sd">            The z-a-m id or the name of the nuclide</span>
<span class="sd">        nucl_list: list</span>
<span class="sd">            The list of nuclides that constitute the sub-set of nuclides</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">nucl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nuclide</span><span class="p">(</span><span class="n">nucl_id</span><span class="p">)</span>
        <span class="n">nucl_dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">current_dens</span>

        <span class="c1"># OpenMC behaves in a bizzare way when certain nuclides are set to 0.0</span>
        <span class="c1"># in material</span>
        <span class="c1"># Here we replaced any 0.0 dens nuclide with 1E-24</span>
        <span class="k">if</span> <span class="n">nucl_dens</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_dens_1_atm</span>

        <span class="k">else</span><span class="p">:</span>

            <span class="n">subtotal_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_subtotal_dens_counting_zero_dens</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">nucl_dens</span><span class="o">/</span><span class="n">subtotal_dens</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the volume of the BUCell in :math:`cm^{-3}`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vol</span>

    <span class="nd">@vol</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">vol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vol</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_vol</span> <span class="o">=</span> <span class="n">vol</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hm_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the volume of the heavy metal regions of the BUCell in :math:`cm^{-3}`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_hm_vol</span>

    <span class="nd">@hm_vol</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">hm_vol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hm_vol</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_hm_vol</span> <span class="o">=</span> <span class="n">hm_vol</span>


<div class="viewcode-block" id="Cell.set_passlist"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_passlist">[docs]</a>    <span class="k">def</span> <span class="nf">set_passlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and sets a Passlist object to the BUCell using the provided nuclides list.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nucl_list: list</span>
<span class="sd">            List of nuclides to create a Passlist object for the BUCell</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_list_redundant</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">redundant_elt</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_list_redundant_elt</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">Nuclide_list_redundant</span><span class="p">(</span><span class="s1">&#39;Cell </span><span class="si">{}</span><span class="s1"> passlist object has been given a redundant nuclide list with following redundant element </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">redundant_elt</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_passlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nucl_list</span><span class="p">):</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="n">pl</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">passlist</span>

<div class="viewcode-block" id="Cell.get_nucl_list"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_nucl_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_nucl_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the list of nuclides contained in the Passlist object of the BUCell.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>

        <span class="k">return</span> <span class="n">passlist</span><span class="o">.</span><span class="n">nucl_list</span></div>

<div class="viewcode-block" id="Cell.get_nuclide"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_nuclide">[docs]</a>    <span class="k">def</span> <span class="nf">get_nuclide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nuclide_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the Passport object of a nuclide.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        nuclide_id: str</span>
<span class="sd">            Name or z-a-m id of a nuclide</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_name</span><span class="p">(</span><span class="n">nuclide_id</span><span class="p">):</span>
            <span class="n">nuclide_id</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">name_to_zamid</span><span class="p">(</span><span class="n">nuclide_id</span><span class="p">)</span>

        <span class="n">passport_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_get_zamid_passport_dict</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">passport_dict</span><span class="p">[</span><span class="n">nuclide_id</span><span class="p">]</span></div>

    <span class="c1"># def update_passlist(self, new_nucl_list):</span>

    <span class="c1">#   current_passlist = self.passlist</span>
    <span class="c1">#   current_passlist.add_nucl_list(new_extra_nuclides)</span>
    <span class="c1">#   merged_nucl_list = current_passlist_nucl_list + list(set(new_nucl_list) - set(current_passlist_nucl_list))</span>

    <span class="c1">#   self.set_passlist(merged_nucl_list)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">passlist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the Passlist object of the BUCell.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_passlist</span>

    <span class="nd">@passlist</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">passlist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">passlist</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_passlist</span> <span class="o">=</span> <span class="n">passlist</span>

    <span class="c1"># These four functions seem obsolete.</span>
    <span class="c1"># @property</span>
    <span class="c1"># def index_dict(self):</span>

    <span class="c1">#     return self._index_dict</span>

    <span class="c1"># @index_dict.setter</span>
    <span class="c1"># def index_dict(self, index_dict):</span>

    <span class="c1">#     self._index_dict = index_dict</span>

    <span class="c1"># @property</span>
    <span class="c1"># def passdic(self):</span>

    <span class="c1">#     return self._passdic</span>

    <span class="c1"># @passdic.setter</span>
    <span class="c1"># def passdic(self, passdic):</span>

    <span class="c1">#     self._passdic = passdic</span>



    <span class="c1"># def _set_sequence_from_input(self, sequence_dict):</span>


    <span class="c1">#   cell_id = self._cell_id</span>
    <span class="c1">#   sequence = seq(cell_id)</span>

    <span class="c1">#   self._set_ihm()</span>
    <span class="c1">#   self._set_bu_sec_conv_factor()</span>

    <span class="c1">#   passlist = self.passlist</span>
    <span class="c1">#   bu_sec_conv_factor = self._bu_sec_conv_factor</span>

    <span class="c1">#   sequence._set_from_input(sequence_dict, passlist, bu_sec_conv_factor)</span>

    <span class="c1">#   self._sequence = sequence</span>

    <span class="c1"># User is not supposed to use this function.</span>
    <span class="c1"># Instead user should use set_sequence from Standalone, System or Couple</span>
    <span class="k">def</span> <span class="nf">_set_sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sequence</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;stand_alone&#39;</span><span class="p">):</span>

        <span class="c1"># A copy of the sequence is done because when setting bu_sec_conv_factor, we don&#39;t want the original to </span>
        <span class="c1"># be changed too because it might be used for other  cells</span>
        <span class="n">sequence_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">sequence</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_ihm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_bu_sec_conv_factor</span><span class="p">()</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">bu_sec_conv_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bu_sec_conv_factor</span>

        <span class="c1">#The _cell_conversion method was actually just calling _set_initial_bucell_bu()</span>
        <span class="c1">#sequence_copy._cell_conversion(passlist, bu_sec_conv_factor, mode)</span>
        <span class="n">sequence_copy</span><span class="o">.</span><span class="n">_set_initial_bucell_bu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span> <span class="o">=</span> <span class="n">sequence_copy</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sequence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sequence</span>




    <span class="c1"># WARNING: ihm is the initial mass</span>
    <span class="c1"># As long as it is set before burn that&#39;s good</span>
    <span class="c1"># But if it is set during or after burn, the value</span>
    <span class="c1"># retrieved by @property will not be the initial mass anymore</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ihm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the initial heavy metal (IHM) mass contained in the BUCell (g).&quot;&quot;&quot;</span>
        <span class="n">ihm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ihm</span>
        <span class="k">if</span> <span class="n">ihm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># define exception for undefined variable</span>

        <span class="k">return</span> <span class="n">ihm</span>

<div class="viewcode-block" id="Cell.get_hm"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_hm">[docs]</a>    <span class="k">def</span> <span class="nf">get_hm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the current heavy metal mass contained in the BUCell (g).&quot;&quot;&quot;</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_hm</span><span class="p">(</span><span class="n">passlist</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hm</span></div>


    <span class="k">def</span> <span class="nf">_set_ihm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_passlist</span>
    <span class="c1">#   hm_vol = self._hm # when user had to define the hm_vol</span>
        <span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span>
    <span class="c1">#   ihm = utils.get_ihm(passlist, hm_vol) # when user had to define the hm_vol</span>
        <span class="n">ihm</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_hm</span><span class="p">(</span><span class="n">passlist</span><span class="p">,</span> <span class="n">vol</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ihm</span> <span class="o">=</span> <span class="n">ihm</span>

<div class="viewcode-block" id="Cell.check_act_presence"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.check_act_presence">[docs]</a>    <span class="k">def</span> <span class="nf">check_act_presence</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether actinides are present in the material of the BUCell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hm</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_hm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hm</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;no&#39;</span>
        <span class="k">elif</span> <span class="n">hm</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;yes&#39;</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bu_sec_conv_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the conversion factor to go from time (seconds) to burnup (MWd/kg) for the BUCell.&quot;&quot;&quot;</span>
        <span class="n">bu_sec_conv_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bu_sec_conv_factor</span>
        <span class="k">if</span> <span class="n">bu_sec_conv_factor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># define exception for undefined variable</span>
        <span class="k">return</span> <span class="n">bu_sec_conv_factor</span>

    <span class="c1"># def set_bu_sec_conv_factor(self, vol, ihm):</span>

    <span class="c1">#     if ihm == 0:</span>
    <span class="c1">#         self._bu_sec_conv_factor = 0</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         self._bu_sec_conv_factor = utils.get_bu_sec_conv_factor(vol, ihm)</span>

    <span class="k">def</span> <span class="nf">_set_bu_sec_conv_factor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">vol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vol</span>
        <span class="n">ihm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ihm</span>

        <span class="k">if</span> <span class="n">ihm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bu_sec_conv_factor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bu_sec_conv_factor</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_bu_sec_conv_factor</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">ihm</span><span class="p">)</span>

    <span class="c1"># Update power density from flux in each cell at each substep</span>
    <span class="k">def</span> <span class="nf">_update_pow_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flux</span><span class="p">):</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">fission_energy_rate</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">conv_Mev_J</span> <span class="o">=</span> <span class="mf">1.60218e-13</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">current_xs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">fission_E</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;fission&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">current_xs</span><span class="p">:</span>
                    <span class="n">fission_xs</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">current_xs</span><span class="p">[</span><span class="s1">&#39;fission&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># cm2 10^-24</span>
                    <span class="n">fission_E</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">fission_E</span> <span class="c1"># MeV</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">current_dens</span> <span class="c1"># cm-1 barn-1 (cm-3 10+24)</span>

                    <span class="c1"># print (i.name)</span>
                    <span class="c1"># print (fission_E)</span>
                    <span class="c1"># print (fission_xs)</span>
                    <span class="c1"># print (dens)</span>

                    <span class="n">fission_energy_rate</span> <span class="o">+=</span> <span class="n">fission_xs</span><span class="o">*</span><span class="n">fission_E</span><span class="o">*</span><span class="n">dens</span>


        <span class="c1"># print (&#39;fission_energy_rate&#39;,fission_energy_rate)</span>

        <span class="n">new_pow_dens</span> <span class="o">=</span> <span class="n">flux</span><span class="o">*</span><span class="p">(</span><span class="n">fission_energy_rate</span><span class="o">*</span><span class="n">conv_Mev_J</span><span class="p">)</span> <span class="c1"># W/cm3 = kW/l</span>

        <span class="c1">#print (&#39;new_pow_dens&#39;,new_pow_dens)</span>

        <span class="k">return</span> <span class="n">new_pow_dens</span>

    <span class="c1"># Update flux from power density in each cell at each substep</span>
    <span class="k">def</span> <span class="nf">_update_flux</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pow_dens</span><span class="p">):</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;update_flux called&#39;</span><span class="p">)</span>
        <span class="n">fission_energy_rate</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">conv_Mev_J</span> <span class="o">=</span> <span class="mf">1.60218e-13</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">fission_E</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">i</span><span class="o">.</span><span class="n">current_xs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;fission&#39;</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">current_xs</span><span class="p">:</span>
                    <span class="n">fission_xs</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">current_xs</span><span class="p">[</span><span class="s1">&#39;fission&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">fission_E</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">fission_E</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">current_dens</span>

                    <span class="n">fission_energy_rate</span> <span class="o">+=</span> <span class="n">fission_xs</span><span class="o">*</span><span class="n">fission_E</span><span class="o">*</span><span class="n">dens</span>

        <span class="n">new_flux</span> <span class="o">=</span> <span class="n">pow_dens</span><span class="o">/</span><span class="p">(</span><span class="n">fission_energy_rate</span><span class="o">*</span><span class="n">conv_Mev_J</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_flux</span>

    <span class="k">def</span> <span class="nf">_change_total_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">density_change_dict</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">density_change_dict</span>
        <span class="k">if</span> <span class="n">density_change_dict</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">density_change_dict</span><span class="p">:</span>
                <span class="n">bucell_density_change_dict</span> <span class="o">=</span> <span class="n">density_change_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="c1"># When user sets a new density for step s+1, the Monte Carlo simulation of step s+1</span>
                <span class="c1"># needs to run with this new density</span>
                <span class="c1"># For conveniency, ONIX thus changes the density at the end of step s</span>
                <span class="c1"># This means that if we are now at step s, we need to look if the user has specified a new </span>
                <span class="c1"># density for step s+1</span>
                <span class="k">if</span> <span class="n">s</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">bucell_density_change_dict</span><span class="p">:</span>

                    <span class="n">new_tot_dens</span> <span class="o">=</span> <span class="n">bucell_density_change_dict</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">current_total_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_dens</span><span class="p">()</span>
                    <span class="n">factor</span> <span class="o">=</span> <span class="n">new_tot_dens</span><span class="o">/</span><span class="n">current_total_dens</span>
                    <span class="n">passport_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
                    <span class="k">for</span> <span class="n">nuc_pass</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
                        <span class="n">current_dens</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span>
                        <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span> <span class="o">=</span> <span class="n">current_dens</span><span class="o">*</span><span class="n">factor</span>

    <span class="k">def</span> <span class="nf">_change_isotope_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>

        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">isotopic_change_dict</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">isotopic_change_dict</span>
        <span class="k">if</span> <span class="n">isotopic_change_dict</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">isotopic_change_dict</span><span class="p">:</span>
                <span class="n">bucell_isotopic_change_dict</span> <span class="o">=</span> <span class="n">isotopic_change_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="n">bucell_isotopic_change_dict</span><span class="p">[</span><span class="s1">&#39;unit&#39;</span><span class="p">]</span>
                <span class="n">current_total_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_dens</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">nucl_name</span> <span class="ow">in</span> <span class="n">bucell_isotopic_change_dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nucl_name</span> <span class="o">==</span> <span class="s1">&#39;unit&#39;</span><span class="p">:</span>
                        <span class="k">continue</span>
                    <span class="n">nuclide_isotopic_change_dict</span> <span class="o">=</span> <span class="n">bucell_isotopic_change_dict</span><span class="p">[</span><span class="n">nucl_name</span><span class="p">]</span>

                    <span class="c1"># When user sets a new density for step s+1, the Monte Carlo simulation of step s+1</span>
                    <span class="c1"># needs to run with this new density</span>
                    <span class="c1"># For conveniency, ONIX thus changes the density at the end of step s</span>
                    <span class="c1"># This means that if we are now at step s, we need to look if the user has specified a new </span>
                    <span class="c1"># density for step s+1</span>
                    <span class="k">if</span> <span class="n">s</span><span class="o">+</span><span class="mi">1</span> <span class="ow">in</span> <span class="n">nuclide_isotopic_change_dict</span><span class="p">:</span>
                        <span class="n">nucl_passport</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nuclide</span><span class="p">(</span><span class="n">nucl_name</span><span class="p">)</span>
                        <span class="c1"># Only the current_dens is set to the user-defined density</span>
                        <span class="c1"># the dens_seq and dens_subseq_mat last value are left unchanged</span>
                        <span class="c1"># However both set_dens_cells (which updates material for new openmc simulation)</span>
                        <span class="c1"># and mat_builder (which prepares the matrix for new depletion calculation) uses</span>
                        <span class="c1"># current_dens. Therefore, only changing current_dens will update calculation without</span>
                        <span class="c1"># changing stored value that will be printed</span>

                        <span class="c1"># If unit is number density</span>
                        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;number density&#39;</span><span class="p">:</span>
                            <span class="n">new_dens</span> <span class="o">=</span> <span class="n">nuclide_isotopic_change_dict</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                        <span class="c1"># else if unit is atom fraction</span>
                        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;atom fraction&#39;</span><span class="p">:</span>
                            <span class="n">new_dens</span> <span class="o">=</span> <span class="n">nuclide_isotopic_change_dict</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">current_total_dens</span>

                        <span class="n">nucl_passport</span><span class="o">.</span><span class="n">current_dens</span> <span class="o">=</span> <span class="n">new_dens</span>


    <span class="c1"># Get the a sub passport list of all actinides</span>
<div class="viewcode-block" id="Cell.get_act_passport_list"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_act_passport_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_act_passport_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of Passport objects of all actinides present in the BUCell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">act_passport_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nucl</span><span class="o">.</span><span class="n">get_FAM</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ACT&#39;</span><span class="p">:</span>
                <span class="n">act_passport_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">act_passport_list</span></div>

    <span class="c1"># Get the a sub passport list of all fission products</span>
<div class="viewcode-block" id="Cell.get_fp_passport_list"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_fp_passport_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_fp_passport_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of Passport objects of all fission products present in the BUCell.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">passport_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">fp_passport_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nucl</span><span class="o">.</span><span class="n">get_FAM</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;FP&#39;</span><span class="p">:</span>
                <span class="n">fp_passport_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fp_passport_list</span></div>

    <span class="c1"># Get the a sub passport list of all activation products</span>
<div class="viewcode-block" id="Cell.get_avt_passport_list"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_avt_passport_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_avt_passport_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of Passport objects of all activation products present in the BUCell.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">avt_passport_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nucl</span><span class="o">.</span><span class="n">get_FAM</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;AVT&#39;</span><span class="p">:</span>
                <span class="n">avt_passport_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucl</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">avt_passport_list</span></div>

    <span class="k">def</span> <span class="nf">_set_libs_from_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lib</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span> <span class="o">=</span> <span class="n">lib</span><span class="p">[</span><span class="s1">&#39;decay_a&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_b_lib</span> <span class="o">=</span> <span class="n">lib</span><span class="p">[</span><span class="s1">&#39;decay_b&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span> <span class="o">=</span> <span class="n">lib</span><span class="p">[</span><span class="s1">&#39;xs&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span> <span class="o">=</span> <span class="n">lib</span><span class="p">[</span><span class="s1">&#39;fy&#39;</span><span class="p">]</span>


    <span class="c1"># Set decay dictionary from a decay text library which path is indicated by the user</span>
<div class="viewcode-block" id="Cell.set_decay_lib"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_decay_lib">[docs]</a>    <span class="k">def</span> <span class="nf">set_decay_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decay_lib_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the decay library for the BUCell.</span>

<span class="sd">        This function will add all nuclides for which there are decay data in the library but which are not yet in the onix.Passlist object of the BUCell. This means that the depletion system will be significantly enlarged.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        decay_lib_path: str</span>
<span class="sd">            Path to the decay library provided by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">decay_b</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_decay_lib</span><span class="p">(</span><span class="n">decay_lib_path</span><span class="p">)</span>
        <span class="n">decay_a</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">conv_decay_b_a</span><span class="p">(</span><span class="n">decay_b</span><span class="p">)</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">decay_a</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="c1">#   self.update_passlist(nucl_list)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_b_lib</span> <span class="o">=</span> <span class="n">decay_b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span> <span class="o">=</span> <span class="n">decay_a</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_decay</span><span class="p">(</span><span class="n">decay_b</span><span class="p">,</span> <span class="n">decay_a</span><span class="p">)</span></div>

    <span class="c1"># Set decay dictionary from the default decay text library</span>
    <span class="c1"># Will add to passlist those nuclides present in the lib that are not present in passlist</span>
<div class="viewcode-block" id="Cell.set_default_decay_lib"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_default_decay_lib">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_decay_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the decay library to the default one (ENDF/B-VIII.0) for the BUCell.</span>

<span class="sd">        This function will add all nuclides for which there are decay data in the library but which are not yet in the onix.Passlist object of the BUCell. This means that the depletion system will be significantly enlarged.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This command will find the absolute path of cell.py</span>
        <span class="c1"># Since cell.py is located in onix, the default library is just in __file__path + ./data/default_libs/decay_lib</span>
        <span class="c1">#__file__path = os.path.abspath(os.path.dirname(__file__))</span>

        <span class="c1">#default_decay_lib_path = __file__path+ &#39;/data/default_libs/decay_lib&#39;</span>
        <span class="n">default_decay_lib_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">default_decay_b_lib_path</span>
        <span class="c1">#default_decay_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/decay_lib&#39;</span>

        <span class="n">decay_b</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_decay_lib</span><span class="p">(</span><span class="n">default_decay_lib_path</span><span class="p">)</span>
        <span class="n">decay_a</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">conv_decay_b_a</span><span class="p">(</span><span class="n">decay_b</span><span class="p">)</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">decay_a</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_b_lib</span> <span class="o">=</span> <span class="n">decay_b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span> <span class="o">=</span> <span class="n">decay_a</span>

        <span class="c1"># If the passlist has already been defined, pass the decay to each nuclide in passlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_decay</span><span class="p">(</span><span class="n">decay_b</span><span class="p">,</span> <span class="n">decay_a</span><span class="p">)</span></div>

    <span class="c1"># Set decay dictionary from the default decay text library</span>
    <span class="c1"># Will NOT add to passlist those nuclides present in the lib that are not present in passlist</span>
<div class="viewcode-block" id="Cell.set_default_decay_lib_no_add"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_default_decay_lib_no_add">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_decay_lib_no_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the decay library to the default one (ENDF/B-VIII.0) for the BUCell.</span>

<span class="sd">        This function will only take nuclear decay data for nuclides that are already in the onix.Passlist object of the BUCell. This enables to run simulation where the depletion system is not enlarged when adding decay data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This command will find the absolute path of cell.py</span>
        <span class="c1"># Since cell.py is located in onix, the default library is just in __file__path + ./data/default_libs/decay_lib</span>
        <span class="n">__file__path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

        <span class="n">default_decay_lib_path</span> <span class="o">=</span> <span class="n">__file__path</span><span class="o">+</span> <span class="s1">&#39;/data/default_libs/decay_lib&#39;</span>

        <span class="c1">#default_decay_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/decay_lib&#39;</span>

        <span class="n">decay_b</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_decay_lib</span><span class="p">(</span><span class="n">default_decay_lib_path</span><span class="p">)</span>
        <span class="n">decay_a</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">conv_decay_b_a</span><span class="p">(</span><span class="n">decay_b</span><span class="p">)</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Passlist_not_defined</span><span class="p">(</span><span class="s1">&#39;No passlist for this cell </span><span class="si">{}</span><span class="s1"> has been defined&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_b_lib</span> <span class="o">=</span> <span class="n">decay_b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span> <span class="o">=</span> <span class="n">decay_a</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_decay</span><span class="p">(</span><span class="n">decay_b</span><span class="p">,</span> <span class="n">decay_a</span><span class="p">)</span></div>

    <span class="c1"># Set the decay dictionary from a decay object defined by the user</span>
<div class="viewcode-block" id="Cell.set_decay"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_decay">[docs]</a>    <span class="k">def</span> <span class="nf">set_decay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decay_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the decay library from an ONIX decay object defined by the user for the BUCell.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object: onix.utils.decay_lib</span>
<span class="sd">            A decay library object constructed by the user with onix.utils.decay_lib.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">decay_b</span> <span class="o">=</span> <span class="n">decay_object</span><span class="o">.</span><span class="n">decay_b</span>
        <span class="n">decay_a</span> <span class="o">=</span> <span class="n">decay_object</span><span class="o">.</span><span class="n">decay_a</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">decay_a</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>  

        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_b_lib</span> <span class="o">=</span> <span class="n">decay_b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span> <span class="o">=</span> <span class="n">decay_a</span>

        <span class="c1"># If the passlist has already been defined, pass the decay to each nuclide in passlist</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_decay</span><span class="p">(</span><span class="n">decay_b</span><span class="p">,</span> <span class="n">decay_a</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">decay_b_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a fractionnal decay dictionnary where keys are nuclides&#39; names and entries are decay sub-dictionnaries. The keys of these sub-dictionnaries are the names of the decay reactions and the entries are the fractions of the corresponding decay constant over the total decay constant.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decay_b_lib</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">decay_a_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an absolute decay dictionnary where keys are nuclides&#39; names and entries are decay sub-dictionnaries. The keys of these sub-dictionnaries are the names of the decay reactions and the entries are the absolute values of the corresponding decay constant in :math:`s^{-1}`.</span>
<span class="sd"> </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span>



<div class="viewcode-block" id="Cell.set_xs_lib"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_xs_lib">[docs]</a>    <span class="k">def</span> <span class="nf">set_xs_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs_lib_path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the cross section library for the BUCell.</span>

<span class="sd">        This function will add all nuclides for which there are cross section data in the library but which are not yet in the onix.Passlist object of the BUCell. This means that the depletion system will be significantly enlarged.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        xs_lib_path: str</span>
<span class="sd">            Path to the cross section library provided by the user</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xs_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_xs_lib</span><span class="p">(</span><span class="n">xs_lib_path</span><span class="p">)</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">xs_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span> <span class="o">=</span> <span class="n">xs_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_xs</span><span class="p">(</span><span class="n">xs_dic</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cell.set_default_xs_lib"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_default_xs_lib">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_xs_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the cross section library to the default one. The default cross section library in ONIX has been obtained by computing middle-burnup one-group cross section for a coupled simumation of a LWR fuel pin-cell. Therefore, this library is only adapted for LWR reactors.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This command will find the absolute path of cell.py</span>
        <span class="c1"># Since cell.py is located in onix, the default library is just in __file__path + ./data/default_libs/decay_lib</span>
        <span class="n">__file__path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

        <span class="n">default_xs_lib_path</span> <span class="o">=</span> <span class="n">__file__path</span><span class="o">+</span> <span class="s1">&#39;/data/default_libs/xs_lib&#39;</span>

        <span class="c1"># default_xs_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/xs_lib&#39;</span>
        <span class="c1"># pupu_xs_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/xs_lib_pupu&#39;</span>

        <span class="n">xs_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_xs_lib</span><span class="p">(</span><span class="n">default_xs_lib_path</span><span class="p">)</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">xs_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span> <span class="o">=</span> <span class="n">xs_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_xs</span><span class="p">(</span><span class="n">xs_dic</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cell.set_default_xs_lib_no_add"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_default_xs_lib_no_add">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_xs_lib_no_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the cross section library to the default one. The default cross section library in ONIX has been obtained by computing middle-burnup one-group cross section for a coupled simumation of a LWR fuel pin-cell. Therefore, this library is only adapted for LWR reactors.</span>

<span class="sd">        This function will only take nuclear decay data for nuclides that are already in the onix.Passlist object of the BUCell. This enables to run simulation where the depletion system is not enlarged when adding cross section data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This command will find the absolute path of cell.py</span>
        <span class="c1"># Since cell.py is located in onix, the default library is just in __file__path + ./data/default_libs/decay_lib</span>
        <span class="n">__file__path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

        <span class="n">default_xs_lib_path</span> <span class="o">=</span> <span class="n">__file__path</span><span class="o">+</span> <span class="s1">&#39;/data/default_libs/xs_lib&#39;</span>

        <span class="c1"># default_xs_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/xs_lib&#39;</span>
        <span class="c1"># pupu_xs_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/xs_lib_pupu&#39;</span>

        <span class="n">xs_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_xs_lib</span><span class="p">(</span><span class="n">default_xs_lib_path</span><span class="p">)</span>

        <span class="n">xs_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_xs_lib</span><span class="p">(</span><span class="n">default_xs_lib_path</span><span class="p">)</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">xs_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Passlist_not_defined</span><span class="p">(</span><span class="s1">&#39;No passlist for this cell </span><span class="si">{}</span><span class="s1"> has been defined&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span> <span class="o">=</span> <span class="n">xs_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_xs</span><span class="p">(</span><span class="n">xs_dic</span><span class="p">)</span></div>

    <span class="c1"># Set the xs dictionary from a xs object</span>
<div class="viewcode-block" id="Cell.set_xs"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_xs">[docs]</a>    <span class="k">def</span> <span class="nf">set_xs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the cross section data from an ONIX cross section object defined by the user for a specific BUCell.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object: onix.utils.xs_lib</span>
<span class="sd">            A cross section library object constructed by the user with onix.utils.xs_lib.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">xs_dic</span> <span class="o">=</span> <span class="n">xs_object</span><span class="o">.</span><span class="n">xs</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">xs_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span> <span class="o">=</span> <span class="n">xs_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_xs</span><span class="p">(</span><span class="n">xs_dic</span><span class="p">)</span></div>

    <span class="c1"># Overwrittes xs at first step if mode is set to constant lib (xs will have already been set from txt library)</span>
    <span class="k">def</span> <span class="nf">_overwrite_xs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xs_object</span><span class="p">):</span>

        <span class="n">xs_dic</span> <span class="o">=</span> <span class="n">xs_object</span><span class="o">.</span><span class="n">xs</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">xs_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span> <span class="o">=</span> <span class="n">xs_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_overwrite_xs</span><span class="p">(</span><span class="n">xs_dic</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">xs_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionnary where keys are nuclides&#39; names and entries are cross section sub-dictionnaries. The keys of these sub-dictionnaries are neutron-induced reactions names and the entries are the value the corresponding cross sections in barn.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span>


<div class="viewcode-block" id="Cell.set_fy_lib"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_fy_lib">[docs]</a>    <span class="k">def</span> <span class="nf">set_fy_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fy_lib_path</span><span class="p">,</span> <span class="n">complete</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the fission yield library for the BUCell.</span>

<span class="sd">        This function will add all nuclides for which there are fission yield data in the library but which are not yet in the onix.Passlist object of the BUCell. This means that the depletion system will be significantly enlarged.</span>

<span class="sd">        Setting the *complete* parameter to True allows ONIX to complement the data of the provided library with additional data found in ENDF/B-VIII.0.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fy_lib_path: str</span>
<span class="sd">            Path to the fission yield library provided by the user</span>
<span class="sd">        complete: bool</span>
<span class="sd">            Indicates to ONIX whether or not to complement the provided library with additional fission yields from ENDF:B-VIII.0 library.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">complete</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>

            <span class="n">fy_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_fy_lib</span><span class="p">(</span><span class="n">fy_lib_path</span><span class="p">)</span>

            <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fy_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

            <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
            <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="c1"># elif complete == True:</span>

        <span class="c1">#   fy_dic = {}</span>

        <span class="c1">#   user_fy_dic = data.read_lib_functions.read_fy_lib(fy_lib_path)</span>

        <span class="c1">#   default_fy_lib_path = data.default_fy_lib_path</span>
        <span class="c1">#   default_fy_dic = data.read_lib_functions.read_fy_lib(default_fy_lib_path)</span>

        <span class="c1">#   # Create nucl_list from merging of two fy_dic key list</span>
        <span class="c1">#   user_fy_nucl_list = list(user_fy_dic.keys())</span>
        <span class="c1">#   default_fy_nucl_list = list(default_fy_dic.keys())</span>
        <span class="c1">#   user_fy_nucl_set = set(user_fy_nucl_list)</span>
        <span class="c1">#   default_fy_nucl_set = set(default_fy_nucl_list)</span>
        <span class="c1">#   in_default_not_in_user = default_fy_nucl_set - user_fy_nucl_set</span>
        <span class="c1">#   nucl_list = user_fy_nucl_list + list(in_default_not_in_user)</span>

        <span class="c1">#   # Creation of a merged dictionnary</span>
        <span class="c1">#   for fp in nucl_list:</span>
        <span class="c1">#       # if fp is not in user_fy but in default, add it to fy_dic with all the parents&#39; data</span>
        <span class="c1">#       if fp not in user_fy_nucl_list:</span>
        <span class="c1">#           fy_dic[fp] = default_fy_dic[fp]</span>

        <span class="c1">#       # if fp is not in default but in user, add it to fy_dic with all the parents&#39; data</span>
        <span class="c1">#       elif fp not in default_fy_nucl_list:</span>
        <span class="c1">#           fy_dic[fp] = user_fy_dic[fp]</span>

        <span class="c1">#       # if fp is in both libraries</span>
        <span class="c1">#       elif fp in user_fy_nucl_list and fp in default_fy_nucl_list:</span>

        <span class="c1">#           # Start by copying the entry from the user library</span>
        <span class="c1">#           fy_dic[fp] = user_fy_dic[fp]</span>

        <span class="c1">#           # Then see what additional parents&#39; data the default has for this specific fp and add it</span>
        <span class="c1">#           user_fy_parents = list(user_fy_dic[fp].keys())</span>
        <span class="c1">#           default_fy_parents = list(default_fy_dic[fp].keys())</span>
        <span class="c1">#           for parent in default_fy_parents:</span>
        <span class="c1">#               if parent not in user_fy_parents:</span>
        <span class="c1">#                   fy_dic[fp][parent] = default_fy_dic[fp][parent] </span>

        <span class="k">elif</span> <span class="n">complete</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">fy_dic</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">user_fy_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_fy_lib</span><span class="p">(</span><span class="n">fy_lib_path</span><span class="p">)</span>
                    <span class="n">default_fy_lib_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">default_fy_lib_path</span>
                    <span class="n">default_fy_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_fy_lib</span><span class="p">(</span><span class="n">default_fy_lib_path</span><span class="p">)</span>
                    <span class="c1"># Create list of actinides in user fy</span>
                    <span class="n">user_fy_nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">user_fy_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">user_act</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">user_fy_nucl_list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">user_fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">act</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_act</span><span class="p">:</span>
                                <span class="n">user_act</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>
                    <span class="c1"># Create list of additional actinides from default fy</span>
                    <span class="n">default_fy_nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">default_fy_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="n">default_add_act</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">default_fy_nucl_list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">default_fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">act</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_act</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">act</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">default_add_act</span><span class="p">):</span>
                                <span class="n">default_add_act</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>   
                    <span class="c1"># Create nucl_list from merging of two fy_dic key list</span>
                    <span class="n">full_fy_nucl_list</span> <span class="o">=</span> <span class="n">user_fy_nucl_list</span> <span class="o">+</span> <span class="n">default_fy_nucl_list</span>
                    <span class="c1"># remove duplicates</span>
                    <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">full_fy_nucl_list</span><span class="p">))</span>
                    <span class="c1"># Creation of a merged dictionary</span>
                    <span class="k">for</span> <span class="n">fp</span> <span class="ow">in</span> <span class="n">nucl_list</span><span class="p">:</span>
                        <span class="c1"># empty dictionary</span>
                        <span class="n">fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="c1"># first add fy from user provided actinides</span>
                        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">user_act</span><span class="p">:</span>
                            <span class="c1"># need to check if fp exist in user lib, otherwise yield zero (second condition is a safety check)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="ow">in</span> <span class="n">user_fy_dic</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">act</span> <span class="ow">in</span> <span class="n">user_fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">]):</span>
                                <span class="n">fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">][</span><span class="n">act</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">][</span><span class="n">act</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span> 
                                <span class="c1"># First zero for FY value, second zero for uncertainty</span>
                                <span class="n">fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">][</span><span class="n">act</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                        <span class="c1"># now add fy from additional actinides from default</span>
                        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">default_add_act</span><span class="p">:</span>   
                            <span class="c1"># need to check if fp exist in default lib, otherwise yield zero (second condition is a safety check)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="ow">in</span> <span class="n">default_fy_dic</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">act</span> <span class="ow">in</span> <span class="n">default_fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">]):</span>
                                <span class="n">fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">][</span><span class="n">act</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">][</span><span class="n">act</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span> 
                                <span class="c1"># First zero for FY value, second zero for uncertainty</span>
                                <span class="n">fy_dic</span><span class="p">[</span><span class="n">fp</span><span class="p">][</span><span class="n">act</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
                    <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>  


        <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span> <span class="o">=</span> <span class="n">fy_dic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_fy</span><span class="p">(</span><span class="n">fy_dic</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cell.set_default_fy_lib"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_default_fy_lib">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_fy_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the fission yield library to the default one (ENDF/B-VIII.0) for the BUCell.</span>

<span class="sd">        This function will add all nuclides for which there are fission yield data in the library but which are not yet in the onix.Passlist object of the BUCell. This means that the depletion system will be significantly enlarged.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This command will find the absolute path of cell.py</span>
        <span class="c1"># Since cell.py is located in onix, the default library is just in __file__path + ./data/default_libs/decay_lib</span>
        <span class="c1"># Probably obsolete</span>
        <span class="n">__file__path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

        <span class="c1">#default_fy_lib_path = __file__path+ &#39;/data/default_libs/fy_lib&#39;</span>

        <span class="n">default_fy_lib_path</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">default_fy_lib_path</span>

        <span class="c1">#default_fy_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/fy_lib&#39;</span>

        <span class="n">fy_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_fy_lib</span><span class="p">(</span><span class="n">default_fy_lib_path</span><span class="p">)</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fy_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span> <span class="o">=</span> <span class="n">fy_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_fy</span><span class="p">(</span><span class="n">fy_dic</span><span class="p">)</span></div>

    <span class="c1"># Warning, for fy, only the FP in the dic are automatically</span>
    <span class="c1"># Added to passlist nucl list. The parents nuclide defined are not</span>
    <span class="c1"># User must make be sure parents nuclide are already in nucl list</span>

<div class="viewcode-block" id="Cell.set_default_fy_lib_no_add"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_default_fy_lib_no_add">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_fy_lib_no_add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the fission yield library to the default one (ENDF/B-VIII.0) for the BUCell.</span>

<span class="sd">        This function will only take fission yield data for nuclides that are already in the onix.Passlist object of the BUCell. This enables to run simulation where the depletion system is not enlarged when adding fission yield data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># This command will find the absolute path of cell.py</span>
        <span class="c1"># Since cell.py is located in onix, the default library is just in __file__path + ./data/default_libs/decay_lib</span>
        <span class="n">__file__path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

        <span class="n">default_fy_lib_path</span> <span class="o">=</span> <span class="n">__file__path</span><span class="o">+</span> <span class="s1">&#39;/data/default_libs/fy_lib&#39;</span>

        <span class="c1">#default_fy_lib_path = &#39;/home/julien/Open-Burnup.dev/onix/data/default_libs/fy_lib&#39;</span>

        <span class="n">fy_dic</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read_lib_functions</span><span class="o">.</span><span class="n">read_fy_lib</span><span class="p">(</span><span class="n">default_fy_lib_path</span><span class="p">)</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Passlist_not_defined</span><span class="p">(</span><span class="s1">&#39;No passlist for this cell </span><span class="si">{}</span><span class="s1"> has been defined&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span> <span class="o">=</span> <span class="n">fy_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_fy</span><span class="p">(</span><span class="n">fy_dic</span><span class="p">)</span></div>

<div class="viewcode-block" id="Cell.set_fy"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.set_fy">[docs]</a>    <span class="k">def</span> <span class="nf">set_fy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fy_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the fission yield library from an ONIX fission yield object defined by the user for the BUCell.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object: onix.utils.fy_lib</span>
<span class="sd">            A fission yield library object constructed by the user with onix.utils.fy_lib.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fy_dic</span> <span class="o">=</span> <span class="n">fy_object</span><span class="o">.</span><span class="n">fy</span>

        <span class="n">nucl_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fy_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="k">if</span> <span class="n">passlist</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_passlist</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">passlist</span><span class="o">.</span><span class="n">_add_nucl_list</span><span class="p">(</span><span class="n">nucl_list</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span> <span class="o">=</span> <span class="n">fy_dic</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_set_fy</span><span class="p">(</span><span class="n">fy_dic</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fy_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionnary where keys are fission products&#39; names and entries are fission yield sub-dictionnaries. The keys of these sub-dictionnaries are fissionning parents&#39; z-a-m id and the entries are the value the corresponding fission yield in percent (values between 0 to 100).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span>




    <span class="k">def</span> <span class="nf">_print_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_point</span><span class="p">,</span> <span class="n">bu_point</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_print_dens_1</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_dens_2</span><span class="p">(</span><span class="n">time_point</span><span class="p">,</span> <span class="n">bu_point</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_print_initial_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>


        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">initial_time</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_seq_vect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">initial_bu</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bu_seq_vect</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># dummy i</span>
        <span class="n">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_print_dens_1</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_dens_2</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_print_xs_lib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">cell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">xs_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xs_lib</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">cell_folder_path</span> <span class="o">+</span> <span class="s1">&#39;/xs_lib&#39;</span>

        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--- Actinides ---</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">xs_lib_header</span>

        <span class="c1">#loop over actinides</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_act_passport_list</span><span class="p">():</span>
            <span class="n">nucl_name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>
            <span class="n">nucl_zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nucl_xs</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">current_xs</span>
            <span class="c1"># If this nuclide has not been assigned cross section, continue</span>
            <span class="k">if</span> <span class="n">nucl_xs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">xs_name</span> <span class="ow">in</span> <span class="n">nucl_xs</span><span class="p">:</span>
                <span class="c1"># removal should not be printed on the lib</span>
                <span class="k">if</span> <span class="n">xs_name</span> <span class="o">==</span>  <span class="s1">&#39;removal&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">xs_val</span> <span class="o">=</span> <span class="n">nucl_xs</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xs_unc</span> <span class="o">=</span> <span class="n">nucl_xs</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^19}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^19}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^12}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_name</span><span class="p">)</span> 
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.16E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_val</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_unc</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--- Fission Products ---</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">xs_lib_header</span>

        <span class="c1">#loop over fission products</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fp_passport_list</span><span class="p">():</span>
            <span class="n">nucl_name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>
            <span class="n">nucl_zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nucl_xs</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">current_xs</span>
            <span class="c1"># If this nuclide has not been assigned cross section, continue</span>
            <span class="k">if</span> <span class="n">nucl_xs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">xs_name</span> <span class="ow">in</span> <span class="n">nucl_xs</span><span class="p">:</span>
                <span class="c1"># removal should not be printed on the lib</span>
                <span class="k">if</span> <span class="n">xs_name</span> <span class="o">==</span>  <span class="s1">&#39;removal&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">xs_val</span> <span class="o">=</span> <span class="n">nucl_xs</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xs_unc</span> <span class="o">=</span> <span class="n">nucl_xs</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^19}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^19}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^12}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_name</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.16E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_val</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_unc</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--- Activation Products ---</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">xs_lib_header</span>

        <span class="c1">#loop over activation products</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_avt_passport_list</span><span class="p">():</span>
            <span class="n">nucl_name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>
            <span class="n">nucl_zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nucl_xs</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">current_xs</span>
            <span class="c1"># If this nuclide has not been assigned cross section, continue</span>
            <span class="k">if</span> <span class="n">nucl_xs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">xs_name</span> <span class="ow">in</span> <span class="n">nucl_xs</span><span class="p">:</span>
                <span class="c1"># removal should not be printed on the lib</span>
                <span class="k">if</span> <span class="n">xs_name</span> <span class="o">==</span>  <span class="s1">&#39;removal&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">xs_val</span> <span class="o">=</span> <span class="n">nucl_xs</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xs_unc</span> <span class="o">=</span> <span class="n">nucl_xs</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^19}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^19}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^12}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_name</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.16E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_val</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_unc</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_general_dens_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">time_point</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_point</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">bu_point</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bu_point</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">cell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>
        <span class="n">total_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_dens</span><span class="p">()</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">cell_folder_path</span> <span class="o">+</span> <span class="s1">&#39;/cell_</span><span class="si">{}</span><span class="s1">_dens&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span>

       <span class="c1"># if os.stat(file_name).st_size == 0:</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;       </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_point</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;       </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bu_point</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
                <span class="n">zamid</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">zamid</span>
                <span class="n">dens</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">current_dens</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1">  </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zamid</span><span class="p">,</span> <span class="n">dens</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;Total  </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_dens</span><span class="p">)</span>
            <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># #    elif os.stat(file_name).st_size != 0:</span>
        <span class="k">elif</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;file already exists&#39;</span><span class="p">)</span>
            <span class="n">read_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">read_file</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">append_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">append_txt</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_point</span><span class="p">)</span>
                    <span class="n">append_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">append_txt</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">append_txt</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bu_point</span><span class="p">)</span>
                    <span class="n">append_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">append_txt</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">append_txt</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">total_dens</span><span class="p">)</span>
                    <span class="n">append_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="n">append_txt</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">-</span><span class="mi">2</span>
                    <span class="n">nuc_pass</span> <span class="o">=</span> <span class="n">passport_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span>
                    <span class="n">append_txt</span> <span class="o">=</span> <span class="s1">&#39; </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span><span class="p">)</span>
                    <span class="n">append_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">append_txt</span><span class="p">)</span>

            <span class="n">read_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">append_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_substep_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="n">cell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>

        <span class="n">time_subseq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="c1"># sequence time subsequence starts with initial point</span>
        
        <span class="c1"># you can&#39;t calculate system_bu_subseq_mat here if the norma is flux and sequence in time</span>
        <span class="c1"># because time to bu requires total power but total power is only known once you have the subseq</span>
        <span class="c1"># evolution of all cells</span>
        <span class="n">system_bu_subseq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">system_bu_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        
        <span class="n">bucell_bu_subseq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bucell_bu_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">flux_subseq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">flux_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="n">pow_dens_subseq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">pow_dens_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="c1"># substeps length is s-1</span>
        <span class="n">substeps</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">cell_folder_path</span> <span class="o">+</span> <span class="s1">&#39;/subdens&#39;</span>

        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_subseq</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYS BU&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_bu_subseq</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;CELL BU&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucell_bu_subseq</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FLUX&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flux_subseq</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW DENS&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_subseq</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_subseq</span><span class="p">[</span><span class="n">ss</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">*</span><span class="mf">1E-3</span><span class="p">)</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="n">zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">get_dens_subseq</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zamid</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_summary_subdens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_path</span><span class="p">):</span>

        <span class="n">cell_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">time_subseq_mat</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_subseq_mat</span>
        <span class="n">system_bu_subseq_mat</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">system_bu_subseq_mat</span>
        <span class="n">bucell_bu_subseq_mat</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bucell_bu_subseq_mat</span>
        <span class="n">flux_subseq_mat</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">flux_subseq_mat</span>
        <span class="n">pow_dens_subseq_mat</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">pow_dens_subseq_mat</span>
        <span class="n">steps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">macrosteps_number</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">summary_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_subdens&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)</span>

        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_subseq_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">))</span><span class="c1"># in days</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">substeps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">ss</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">))</span><span class="c1"># in days</span>


        <span class="c1"># Having onix storing the system bu subseq is a little laborious</span>
        <span class="c1"># I let it aside for now</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYS BU&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_bu_subseq_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">substeps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_bu_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;CELL BU&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucell_bu_subseq_mat</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">substeps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucell_bu_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FLUX&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">substeps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flux_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW DENS&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">substeps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">substeps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">ss</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">*</span><span class="mf">1E-3</span><span class="p">)</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="n">zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>

            <span class="n">dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zamid</span><span class="p">)</span>
            <span class="n">init_dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_dens</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                <span class="n">substeps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">microsteps_number</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">substeps_number</span><span class="p">):</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dens</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_summary_dens</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_path</span><span class="p">):</span>

        <span class="n">cell_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">time_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_seq</span>
        <span class="n">system_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">system_bu_seq</span>
        <span class="n">bucell_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bucell_bu_seq</span>
        <span class="n">flux_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">flux_seq</span>
        <span class="n">pow_dens_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">pow_dens_seq</span>
        <span class="n">steps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">macrosteps_number</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">summary_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_dens&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)</span>

        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;NUCL&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ZAMID&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TIME [days]&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">))</span><span class="c1"># in days</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">))</span><span class="c1"># in days</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYSTEM-BU&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_bu_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_bu_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;CELL-BU&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucell_bu_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucell_bu_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FLUX&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flux_seq</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW-DENS&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_seq</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;20}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">*</span><span class="mf">1E-3</span><span class="p">)</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="n">zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zamid</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">init_dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_dens</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                <span class="n">dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dens</span><span class="p">)</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_summary_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_path</span><span class="p">):</span>

        <span class="n">cell_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">time_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_seq</span>
        <span class="n">system_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">system_bu_seq</span>
        <span class="n">bucell_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bucell_bu_seq</span>
        <span class="n">flux_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">flux_seq</span>
        <span class="n">pow_dens_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">pow_dens_seq</span>
        <span class="n">steps_number</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">macrosteps_number</span>
        <span class="n">file_name</span> <span class="o">=</span> <span class="n">summary_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_activity&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)</span>

        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;NUCL&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ZAMID&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;HL [s]&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TIME [days]&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">))</span><span class="c1"># in days</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">))</span><span class="c1"># in days</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;33}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYSTEM-BU&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_bu_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">system_bu_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;33}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;CELL-BU&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucell_bu_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bucell_bu_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;33}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;FLUX&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">flux_seq</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;33}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW-DENS&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_seq</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;33}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;POW&#39;</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pow_dens_seq</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">*</span><span class="mf">1E-3</span><span class="p">)</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="n">zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>
            <span class="n">decay</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">decay_a</span>

            <span class="k">if</span> <span class="n">decay</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>

                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;N/A&#39;</span><span class="p">)</span>
                <span class="n">init_act</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_act</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                    <span class="n">act</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>


            <span class="k">elif</span> <span class="n">decay</span> <span class="o">==</span> <span class="s1">&#39;stable&#39;</span><span class="p">:</span>

                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;stable&#39;</span><span class="p">)</span>
                <span class="n">init_act</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_act</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                    <span class="n">act</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>


            <span class="k">else</span><span class="p">:</span>

                <span class="n">decay_val</span> <span class="o">=</span> <span class="n">decay</span><span class="p">[</span><span class="s1">&#39;total decay&#39;</span><span class="p">]</span>
                <span class="n">hl</span> <span class="o">=</span> <span class="n">decay</span><span class="p">[</span><span class="s1">&#39;half-life&#39;</span><span class="p">]</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;10}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">hl</span><span class="p">)</span>
                <span class="n">init_act</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">decay_val</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">init_act</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps_number</span><span class="p">):</span>
                    <span class="n">dens</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_seq</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">act</span> <span class="o">=</span> <span class="n">dens</span><span class="o">*</span><span class="n">decay_val</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;13.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">act</span><span class="p">)</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_print_summary_flux_spectrum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_path</span><span class="p">,</span> <span class="n">mg_energy_bin</span><span class="p">):</span>

        <span class="n">bucell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">time_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_seq</span>
        <span class="n">system_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">system_bu_seq</span>
        <span class="n">bucell_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bucell_bu_seq</span>
        <span class="n">flux_spectrum_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">flux_spectrum_seq</span>

        <span class="n">bin_len</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">-</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mg_energy_bin</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">mg_energy_bin</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">mid_points</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">mg_energy_bin</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">mg_energy_bin</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">summary_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_flux_spectrum&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;34}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ENERGY-BIN&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mg_energy_bin</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^18.10E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;52}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ENERGY-BIN-LEN&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">bin_len</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^18.10E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;52}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ENERGY-MID-POINTS&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mid_points</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^18.10E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="n">flux_spectrum_seq_lethargy</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">flux_spectrum_seq</span><span class="p">)):</span>
            <span class="n">flux_spectrum_seq_lethargy</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">/</span><span class="n">z</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flux_spectrum_seq</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">mid_points</span><span class="p">,</span> <span class="n">bin_len</span><span class="p">)])</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;  TIME    SYSTEM-BU    BUCELL-BU  </span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_seq</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span> <span class="c1"># in day</span>
            <span class="n">system_bu</span> <span class="o">=</span> <span class="n">system_bu_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">bucell_bu</span> <span class="o">=</span> <span class="n">bucell_bu_seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^8.6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">time</span><span class="p">))</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13.6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">system_bu</span><span class="p">))</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^13.6}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">bucell_bu</span><span class="p">))</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:18}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">flux_spectrum_seq_lethargy</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^18.10E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>


        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_print_summary_xs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_path</span><span class="p">):</span>

        <span class="n">bucell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">time_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_seq</span>
        <span class="n">system_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">system_bu_seq</span>
        <span class="n">bucell_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bucell_bu_seq</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">summary_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_xs_lib&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="c1"># Write time, system burnup and cell burnup</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;51}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">time_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="c1"># initial time is discarded as no XS are defined for it</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;51}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYSTEM-BU&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">system_bu_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="c1"># initial time is discarded as no XS are defined for it</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bu</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;51}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;BUCELL-BU&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">bucell_bu_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="c1"># initial time is discarded as no XS are defined for it</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bu</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--- Actinides ---</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="c1">#txt += utils.printer.xs_lib_header</span>

        <span class="c1">#loop over actinides</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_act_passport_list</span><span class="p">():</span>
            <span class="n">nucl_name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>
            <span class="n">nucl_zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nucl_xs_seq</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">xs_seq</span>
            <span class="c1"># If this nuclide has not been assigned cross section, continue</span>
            <span class="k">if</span> <span class="n">nucl_xs_seq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sample_dict</span> <span class="o">=</span> <span class="n">nucl_xs_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># the xs names should be the same at each step</span>
            <span class="k">for</span> <span class="n">xs_name</span> <span class="ow">in</span> <span class="n">sample_dict</span><span class="p">:</span>
                <span class="c1"># removal should not be printed on the lib</span>
                <span class="k">if</span> <span class="n">xs_name</span> <span class="o">==</span>  <span class="s1">&#39;removal&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">xs_dict</span> <span class="ow">in</span> <span class="n">nucl_xs_seq</span><span class="p">:</span>
                    <span class="n">xs_val</span> <span class="o">=</span> <span class="n">xs_dict</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.8E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_val</span><span class="p">)</span>

                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--- Fission Products ---</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">xs_lib_header</span>

        <span class="c1">#loop over fission products</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fp_passport_list</span><span class="p">():</span>
            <span class="n">nucl_name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>
            <span class="n">nucl_zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nucl_xs_seq</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">xs_seq</span>
            <span class="c1"># If this nuclide has not been assigned cross section, continue</span>
            <span class="k">if</span> <span class="n">nucl_xs_seq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sample_dict</span> <span class="o">=</span> <span class="n">nucl_xs_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># the xs names should be the same at each step</span>
            <span class="k">for</span> <span class="n">xs_name</span> <span class="ow">in</span> <span class="n">sample_dict</span><span class="p">:</span>
                <span class="c1"># removal should not be printed on the lib</span>
                <span class="k">if</span> <span class="n">xs_name</span> <span class="o">==</span>  <span class="s1">&#39;removal&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">xs_dict</span> <span class="ow">in</span> <span class="n">nucl_xs_seq</span><span class="p">:</span>
                    <span class="n">xs_val</span> <span class="o">=</span> <span class="n">xs_dict</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.8E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_val</span><span class="p">)</span>

                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">--- Activation Products ---</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="n">utils</span><span class="o">.</span><span class="n">printer</span><span class="o">.</span><span class="n">xs_lib_header</span>

        <span class="c1">#loop over activation products</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_avt_passport_list</span><span class="p">():</span>
            <span class="n">nucl_name</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">name</span>
            <span class="n">nucl_zamid</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nucl_xs_seq</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">xs_seq</span>
            <span class="c1"># If this nuclide has not been assigned cross section, continue</span>
            <span class="k">if</span> <span class="n">nucl_xs_seq</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">sample_dict</span> <span class="o">=</span> <span class="n">nucl_xs_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># the xs names should be the same at each step</span>
            <span class="k">for</span> <span class="n">xs_name</span> <span class="ow">in</span> <span class="n">sample_dict</span><span class="p">:</span>
                <span class="c1"># removal should not be printed on the lib</span>
                <span class="k">if</span> <span class="n">xs_name</span> <span class="o">==</span>  <span class="s1">&#39;removal&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl_zamid</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">xs_dict</span> <span class="ow">in</span> <span class="n">nucl_xs_seq</span><span class="p">:</span>
                    <span class="n">xs_val</span> <span class="o">=</span> <span class="n">xs_dict</span><span class="p">[</span><span class="n">xs_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.8E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xs_val</span><span class="p">)</span>

                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># Decay lib shoult not change. But I still implement an on the fly get</span>

    <span class="k">def</span> <span class="nf">_print_summary_isomeric_branching_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_path</span><span class="p">):</span>

        <span class="n">bucell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>
        <span class="n">time_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">time_seq</span>
        <span class="n">system_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">system_bu_seq</span>
        <span class="n">bucell_bu_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">bucell_bu_seq</span>
        <span class="n">isomeric_branching_ratio_seq</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">isomeric_branching_ratio_seq</span>


        <span class="n">file_name</span> <span class="o">=</span> <span class="n">summary_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_isomeric_branching_ratio&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">write_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="c1"># Write time, system burnup and cell burnup</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">time_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="c1"># initial time is discarded as no XS are defined for it</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="o">/</span><span class="p">(</span><span class="mi">24</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;SYSTEM-BU&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">system_bu_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="c1"># initial time is discarded as no XS are defined for it</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bu</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;BUCELL-BU&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">bu</span> <span class="ow">in</span> <span class="n">bucell_bu_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span> <span class="c1"># initial time is discarded as no XS are defined for it</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.5E}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bu</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="c1">#loop over nucl in isomeric branching </span>
        <span class="n">unordered_nucl_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">isomeric_branching_ratio_seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">unordered_nucl_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nucl</span><span class="p">)</span>

        <span class="n">ordered_nucl_list</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">order_nuclide_name_per_z</span><span class="p">(</span><span class="n">unordered_nucl_list</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">ordered_nucl_list</span><span class="p">:</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl</span><span class="p">)</span>

            <span class="c1"># First loop over the ground state ratio</span>
            <span class="k">for</span> <span class="n">isomeric_branching_ratio</span> <span class="ow">in</span> <span class="n">isomeric_branching_ratio_seq</span><span class="p">:</span>

                <span class="n">nucl_data</span> <span class="o">=</span> <span class="n">isomeric_branching_ratio</span><span class="p">[</span><span class="n">nucl</span><span class="p">]</span>
                <span class="n">ratio_to_gs</span> <span class="o">=</span> <span class="n">nucl_data</span><span class="p">[</span><span class="s1">&#39;(n,gamma)&#39;</span><span class="p">]</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ratio_to_gs</span><span class="p">)</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="c1"># then loop over the metastable state ratio</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:&lt;17}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">isomeric_branching_ratio</span> <span class="ow">in</span> <span class="n">isomeric_branching_ratio_seq</span><span class="p">:</span>

                <span class="n">nucl_data</span> <span class="o">=</span> <span class="n">isomeric_branching_ratio</span><span class="p">[</span><span class="n">nucl</span><span class="p">]</span>
                <span class="n">ratio_to_ms</span> <span class="o">=</span> <span class="n">nucl_data</span><span class="p">[</span><span class="s1">&#39;(n,gamma)X&#39;</span><span class="p">]</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{:^17.4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ratio_to_ms</span><span class="p">)</span>

            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="n">write_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">write_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_decay_nucl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of nuclides for which decay data exists in the provided decay library.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">decay_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span>
        <span class="n">decay_nucl</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_decay_nucl</span><span class="p">(</span><span class="n">decay_lib</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">decay_nucl</span>



    <span class="c1"># xs lib can change so I implement a get on the fly</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_xs_nucl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of nuclides for which cross section data exists in the provided cross section library.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xs_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xs_lib</span>
        <span class="n">xs_nucl</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_xs_nucl</span><span class="p">(</span><span class="n">xs_lib</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">xs_nucl</span>


    <span class="c1"># fy lib can change so I implement a get on the fly</span>

<div class="viewcode-block" id="Cell.get_fy_nucl"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_fy_nucl">[docs]</a>    <span class="k">def</span> <span class="nf">get_fy_nucl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of fission products for which fission yields data exists in the provided fission yield data library.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fy_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span>
        <span class="n">fy_nucl</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_fy_nucl</span><span class="p">(</span><span class="n">fy_lib</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fy_nucl</span></div>




<div class="viewcode-block" id="Cell.get_lib_nucl"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_lib_nucl">[docs]</a>    <span class="k">def</span> <span class="nf">get_lib_nucl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the full list of nuclides for which there are data in the nuclear libraries (deay, cross section or fission yield). This is the full list of nuclides modelled in the depletion network.</span>

<span class="sd">        This command does not work when the mode for cross sections is set to &#39;constant lib&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">decay_a_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decay_a_lib</span>

        <span class="c1"># In couple mode, the xs_lib is only set after MC simulation. Therefore, it would only be possible</span>
        <span class="c1"># to build lib_nucl after MC call. This is not practical as lib_nucl is needed before the loop begins</span>
        <span class="c1"># Instead, MC_XS_nucl_list is used. It is not a lib but a list of nuclides.</span>
        <span class="c1"># This change is however not compatible if user wants to use constant cross section as lib nucl will rely</span>
        <span class="c1"># only on MC_nucl_list for nuclides with xs data</span>
        <span class="c1">#xs_lib = self._xs_lib</span>
        <span class="n">MC_XS_nucl_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MC_XS_nucl_list</span>

        <span class="n">fy_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fy_lib</span>

        <span class="n">decay_fy_lib_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">decay_a_lib</span><span class="p">,</span> <span class="n">fy_lib</span><span class="p">]</span>

        <span class="c1">#if decay_a_lib == None and xs_lib == None and fy_lib == None:</span>
        <span class="k">if</span> <span class="n">decay_a_lib</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fy_lib</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">No_nuclear_lib_set</span><span class="p">(</span><span class="s1">&#39;Cell </span><span class="si">{}</span><span class="s1"> has not been attributed decay and fy data library&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>

        <span class="n">decay_fy_lib_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">dic</span> <span class="k">for</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">decay_fy_lib_list</span> <span class="k">if</span> <span class="n">dic</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">]</span>

        <span class="n">decay_fy_lib_nucl</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_all_nucl</span><span class="p">(</span><span class="n">decay_fy_lib_list</span><span class="p">)</span>
        <span class="c1">#print (decay_fy_lib_nucl)</span>
        <span class="n">unfiltered_lib_nucl</span> <span class="o">=</span> <span class="n">decay_fy_lib_nucl</span> <span class="o">+</span> <span class="n">MC_XS_nucl_list</span>
        <span class="n">lib_nucl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">unfiltered_lib_nucl</span><span class="p">))</span>


        <span class="k">return</span> <span class="n">lib_nucl</span></div>


<div class="viewcode-block" id="Cell.get_fy_parent_nucl"><a class="viewcode-back" href="../../pythonapi/generated/onix.Cell.html#onix.Cell.get_fy_parent_nucl">[docs]</a>    <span class="k">def</span> <span class="nf">get_fy_parent_nucl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the list of fissioning parents for which data exist in the fission yield library.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fy_lib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fy_lib</span>
        <span class="n">fy_parent</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_fy_parent_nucl</span><span class="p">(</span><span class="n">fy_lib</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fy_parent</span></div>


    <span class="c1"># This set somehow uptset the on the fly nature of the </span>
    <span class="c1"># various nuclide list. Will have to deal with that later</span>

    <span class="c1"># def _set_nucl_list(self):</span>

    <span class="c1">#   decay_a_lib = self._decay_a_lib</span>
    <span class="c1">#   xs_lib = self._xs_lib</span>
    <span class="c1">#   fy_lib = self._fy_lib</span>

    <span class="c1">#   self._decay_nucl = self.get_decay_nucl</span>
    <span class="c1">#   self._xs_nucl = self.get_xs_nucl</span>
    <span class="c1">#   self._fy_nucl = self.get_fy_nucl</span>
    <span class="c1">#   self._fy_parent_nucl = self.get_fy_parent_nucl</span>
    <span class="c1">#   self._all_nucl = self.get_all_nucl</span>


    <span class="k">def</span> <span class="nf">_set_MC_tallies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mc_nuclide_densities</span><span class="p">,</span> <span class="n">flux_tally</span><span class="p">,</span> <span class="n">flux_spectrum_tally</span><span class="p">,</span> <span class="n">rxn_rate_tally</span><span class="p">,</span> <span class="n">sampled_isomeric_branching_data</span><span class="p">,</span> <span class="n">sampled_ng_cross_section_data</span><span class="p">,</span> <span class="n">xs_mode</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="n">MC_flux</span> <span class="o">=</span> <span class="n">flux_tally</span><span class="o">.</span><span class="n">mean</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">_set_macrostep_MC_flux</span><span class="p">(</span><span class="n">MC_flux</span><span class="p">)</span>

        <span class="n">flux_spectrum</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">flux_spectrum_tally</span><span class="o">.</span><span class="n">mean</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">_set_macrostep_flux_spectrum</span><span class="p">(</span><span class="n">flux_spectrum</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_step_isomeric_branching_ratio</span><span class="p">(</span><span class="n">flux_spectrum</span><span class="p">,</span> <span class="n">sampled_isomeric_branching_data</span><span class="p">,</span> <span class="n">sampled_ng_cross_section_data</span><span class="p">)</span>

        <span class="c1"># rxn_rate_tally are distributed in a xs_dict object</span>
        <span class="n">xs_lib</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">xs_lib</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> rxn rate&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">nuclides</span> <span class="o">=</span> <span class="n">rxn_rate_tally</span><span class="o">.</span><span class="n">nuclides</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="n">rxn_rate_tally</span><span class="o">.</span><span class="n">scores</span>
        <span class="n">macro_xs</span> <span class="o">=</span> <span class="n">rxn_rate_tally</span> <span class="o">/</span> <span class="n">flux_tally</span>
        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">nucl_dict</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">_get_name_passport_dict</span><span class="p">()</span>
        <span class="n">isomeric_branching_ratio</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">current_isomeric_branching_ratio</span>


        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">nuclides</span><span class="p">:</span>

            <span class="n">onix_nucl_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">openmc_name_to_onix_name</span><span class="p">(</span><span class="n">nucl</span><span class="p">)</span>
            <span class="n">nucl_passport</span> <span class="o">=</span> <span class="n">nucl_dict</span><span class="p">[</span><span class="n">onix_nucl_name</span><span class="p">]</span>

            <span class="c1"># If the nuclide is artificially added to openmc material with 1 atm</span>
            <span class="c1"># Its density set for onix is 0</span>
            <span class="c1"># But the macro xs need to be divided by 1E-24 and not 0</span>

            <span class="k">if</span> <span class="n">nucl_passport</span><span class="o">.</span><span class="n">current_dens</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>

                <span class="c1"># mc_nuclide_densities gives a tuples where the first element is the nuclide name</span>
                <span class="c1"># and the second element is the density</span>
                <span class="c1">#nucl_dens = mc_nuclide_densities[nucl][1]</span>

                <span class="n">nucl_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zero_dens_1_atm</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nucl_dens</span> <span class="o">=</span> <span class="n">nucl_passport</span><span class="o">.</span><span class="n">current_dens</span>
            <span class="n">xs_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
                <span class="n">macro_xs_val</span> <span class="o">=</span> <span class="n">macro_xs</span><span class="o">.</span><span class="n">get_values</span><span class="p">(</span><span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1"> / flux)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">score</span><span class="p">)],</span> <span class="n">nuclides</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;(</span><span class="si">{}</span><span class="s1"> / total)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl</span><span class="p">)])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">xs_val</span> <span class="o">=</span> <span class="n">macro_xs_val</span><span class="o">/</span><span class="n">nucl_dens</span>
                <span class="n">xs_dict</span><span class="p">[</span><span class="n">score</span><span class="p">]</span> <span class="o">=</span> <span class="n">xs_val</span>
            <span class="n">xs_lib</span><span class="o">.</span><span class="n">add_xs_dict</span><span class="p">(</span><span class="n">nucl_passport</span><span class="o">.</span><span class="n">zamid</span><span class="p">,</span> <span class="n">xs_dict</span><span class="p">)</span>

        <span class="c1"># This function screens the the xs_lib and look for which nuclide ngamma reactions needs to </span>
        <span class="c1"># be branched</span>
        <span class="n">xs_lib</span><span class="o">.</span><span class="n">_isomeric_branching_weighting</span><span class="p">(</span><span class="n">isomeric_branching_ratio</span><span class="p">)</span>

        <span class="c1"># Here, in constant lib mode, if it is the first step, you need to call </span>
        <span class="c1"># overwrite xs (because the xs will have been already set by constant lib)</span>
        <span class="k">if</span> <span class="n">xs_mode</span> <span class="o">==</span> <span class="s1">&#39;constant lib&#39;</span> <span class="ow">and</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_overwrite_xs</span><span class="p">(</span><span class="n">xs_lib</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_xs</span><span class="p">(</span><span class="n">xs_lib</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_step_isomeric_branching_ratio</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flux_spectrum</span><span class="p">,</span> <span class="n">sampled_isomeric_branching_data</span><span class="p">,</span> <span class="n">sampled_ng_cross_section_data</span><span class="p">):</span>

        <span class="n">isomeric_branching_ratio</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">sampled_isomeric_branching_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">sampled_ng_cross_section_data</span><span class="p">:</span>
                <span class="n">isomeric_branching_ratio</span><span class="p">[</span><span class="n">nucl</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">branching_data</span> <span class="o">=</span> <span class="n">sampled_isomeric_branching_data</span><span class="p">[</span><span class="n">nucl</span><span class="p">]</span>
                <span class="n">xs_data</span> <span class="o">=</span> <span class="n">sampled_ng_cross_section_data</span><span class="p">[</span><span class="n">nucl</span><span class="p">]</span>

                <span class="n">numerator_ground</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">z</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flux_spectrum</span><span class="p">,</span><span class="n">branching_data</span><span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">],</span><span class="n">xs_data</span><span class="p">)])</span>
                <span class="n">numerator_excited</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">z</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flux_spectrum</span><span class="p">,</span><span class="n">branching_data</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span><span class="n">xs_data</span><span class="p">)])</span>
                <span class="n">denominator</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">flux_spectrum</span><span class="p">,</span><span class="n">xs_data</span><span class="p">)])</span>
                <span class="n">isomeric_branching_ratio</span><span class="p">[</span><span class="n">nucl</span><span class="p">][</span><span class="s1">&#39;(n,gamma)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numerator_ground</span><span class="o">/</span><span class="n">denominator</span>
                <span class="n">isomeric_branching_ratio</span><span class="p">[</span><span class="n">nucl</span><span class="p">][</span><span class="s1">&#39;(n,gamma)X&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">numerator_excited</span><span class="o">/</span><span class="n">denominator</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span><span class="o">.</span><span class="n">_set_macrostep_isomeric_branching_ratio</span><span class="p">(</span><span class="n">isomeric_branching_ratio</span><span class="p">)</span>
        

    <span class="k">def</span> <span class="nf">_set_allreacs_dic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">ss</span><span class="p">,</span> <span class="n">ssn</span><span class="p">):</span>


        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passport_list</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">passport_dict</span> <span class="o">=</span> <span class="n">passlist</span><span class="o">.</span><span class="n">_get_zamid_passport_dict</span><span class="p">()</span>

        <span class="n">sequence</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span>

        <span class="c1">#flux = sequence.flux_point(s)</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="n">sequence</span><span class="o">.</span><span class="n">current_flux</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">passport_list</span><span class="p">)</span>

        <span class="c1"># EOS = 1 means that the sequence reached end of step</span>
        <span class="n">EOS</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">ss</span> <span class="o">==</span> <span class="n">ssn</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">EOS</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">nuc_pass</span> <span class="o">=</span> <span class="n">passport_list</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
            <span class="n">nuc_zamid</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nuc_name</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">name</span>
            <span class="n">nuc_dens</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_dens</span>
            <span class="n">creation_dic</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">destruction_dic</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">allreacs_dic</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">decay_a</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">decay_a</span> <span class="o">!=</span> <span class="s1">&#39;stable&#39;</span><span class="p">:</span>
                <span class="n">decay</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">decay_a</span>
                <span class="n">decay_rate</span> <span class="o">=</span> <span class="n">decay</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">del</span> <span class="n">decay_rate</span><span class="p">[</span><span class="s1">&#39;total decay&#39;</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">decay_rate</span><span class="p">[</span><span class="s1">&#39;half-life&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decay_rate</span><span class="p">:</span>
                    <span class="n">decay_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">decay_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">nuc_dens</span>
                <span class="n">destruction_dic</span> <span class="o">=</span> <span class="n">decay_rate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>



            <span class="c1"># Multiply xs by flux</span>
            <span class="k">if</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_xs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xs</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">current_xs</span>
                <span class="n">xs_rate</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
                    <span class="n">xs_rate</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">flux</span><span class="o">*</span><span class="mf">1e-24</span><span class="o">*</span><span class="n">nuc_dens</span>
                <span class="n">destruction_dic</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">xs_rate</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">destruction_dic</span><span class="p">[</span><span class="s1">&#39;removal&#39;</span><span class="p">]</span>

            <span class="c1"># Multiply fy by xs fission of father and phi</span>
            <span class="k">if</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">fy</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fy</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">fy</span>
                <span class="n">fy_rate</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fy</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">passport_dict</span><span class="p">:</span>
                        <span class="n">father_pass</span> <span class="o">=</span> <span class="n">passport_dict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">father_dens</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_dens</span>
                        <span class="n">father_name</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">name</span>
                        <span class="k">if</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_xs</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="s1">&#39;fission&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_xs</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="n">father_fission_xs</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_xs</span><span class="p">[</span><span class="s1">&#39;fission&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">entry</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> fission&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">father_name</span><span class="p">)</span>
                        <span class="n">fy_rate</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">fy</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1e-2</span><span class="o">*</span><span class="n">father_fission_xs</span><span class="o">*</span><span class="n">flux</span><span class="o">*</span><span class="mf">1e-24</span><span class="o">*</span><span class="n">father_dens</span>
                <span class="n">creation_dic</span> <span class="o">=</span> <span class="n">fy_rate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Now we gather the creation terms (excluding fission as it has been already collected in fyxsphi)</span>
            <span class="n">xs_parent</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">xs_parent</span>
            <span class="n">decay_parent</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">decay_parent</span>

            <span class="n">xs_parent_val</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xs_parent</span><span class="p">:</span>
                <span class="n">father_zamid</span> <span class="o">=</span> <span class="n">xs_parent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">father_zamid</span> <span class="ow">in</span> <span class="n">passport_dict</span><span class="p">:</span>
                    <span class="n">father_pass</span> <span class="o">=</span> <span class="n">passport_dict</span><span class="p">[</span><span class="n">father_zamid</span><span class="p">]</span>
                    <span class="n">father_dens</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_dens</span>
                    <span class="n">father_state</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">state</span>
                    <span class="n">father_name</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">name</span>
                    <span class="c1"># The reacname from xs_parent is different from parent_xs in case parent is in excited state</span>
                    <span class="k">if</span> <span class="n">father_state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">reac_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">elif</span> <span class="n">father_state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">reac_name</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">if</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_xs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">reac_name</span> <span class="ow">in</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_xs</span><span class="p">:</span>
                            <span class="n">father_xs_rate</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_xs</span><span class="p">[</span><span class="n">reac_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">flux</span><span class="o">*</span><span class="mf">1e-24</span><span class="o">*</span><span class="n">father_dens</span>

                            <span class="n">entry</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">father_name</span><span class="p">,</span> <span class="n">reac_name</span><span class="p">)</span>

                            <span class="n">xs_parent_val</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">father_xs_rate</span>
            <span class="n">creation_dic</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">xs_parent_val</span><span class="p">)</span>

            <span class="n">decay_parent_val</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">decay_parent</span><span class="p">:</span>
                <span class="n">father_zamid</span> <span class="o">=</span> <span class="n">decay_parent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">father_zamid</span> <span class="ow">in</span> <span class="n">passport_dict</span><span class="p">:</span>
                    <span class="n">father_pass</span> <span class="o">=</span> <span class="n">passport_dict</span><span class="p">[</span><span class="n">father_zamid</span><span class="p">]</span>
                    <span class="n">father_dens</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">current_dens</span>
                    <span class="n">father_state</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">state</span>
                    <span class="n">father_name</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">name</span>
                    <span class="c1"># The reacname from xs_parent is different from parent_xs in case parent is in excited state</span>
                    <span class="k">if</span> <span class="n">father_state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">reac_name</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                    <span class="k">elif</span> <span class="n">father_state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">reac_name</span> <span class="o">=</span> <span class="n">i</span>
                    <span class="k">if</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">decay_a</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">decay_a</span> <span class="o">!=</span> <span class="s1">&#39;stable&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">reac_name</span> <span class="ow">in</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">decay_a</span><span class="p">:</span>
                            <span class="n">father_decay</span> <span class="o">=</span> <span class="n">father_pass</span><span class="o">.</span><span class="n">decay_a</span><span class="p">[</span><span class="n">reac_name</span><span class="p">]</span><span class="o">*</span><span class="n">father_dens</span>

                            <span class="n">entry</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">father_name</span><span class="p">,</span> <span class="n">reac_name</span><span class="p">)</span>

                            <span class="n">decay_parent_val</span><span class="p">[</span><span class="n">entry</span><span class="p">]</span> <span class="o">=</span> <span class="n">father_decay</span>
            <span class="n">creation_dic</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">decay_parent_val</span><span class="p">)</span>

            <span class="n">allreacs_dic</span> <span class="o">=</span> <span class="n">destruction_dic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">allreacs_dic</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">creation_dic</span><span class="p">)</span>

            <span class="n">nuc_pass</span><span class="o">.</span><span class="n">destruction_dic</span> <span class="o">=</span> <span class="n">destruction_dic</span>
            <span class="n">nuc_pass</span><span class="o">.</span><span class="n">creation_dic</span> <span class="o">=</span> <span class="n">creation_dic</span>
            <span class="n">nuc_pass</span><span class="o">.</span><span class="n">allreacs_dic</span> <span class="o">=</span> <span class="n">allreacs_dic</span>
            <span class="n">nuc_pass</span><span class="o">.</span><span class="n">_allreacs_dic_list_append</span><span class="p">(</span><span class="n">allreacs_dic</span><span class="p">)</span>

            <span class="n">sorted_allreacs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">allreacs_dic</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">nuc_pass</span><span class="o">.</span><span class="n">_append_current_sorted_allreacs_tuple_list</span><span class="p">(</span><span class="n">sorted_allreacs</span><span class="p">,</span> <span class="n">ss</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">EOS</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">nuc_pass</span><span class="o">.</span><span class="n">_append_sorted_allreacs_tuple_mat</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_current_allreacs_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">passport_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">cell_folder_path</span> <span class="o">+</span><span class="s1">&#39;/cell_</span><span class="si">{}</span><span class="s1">_reacs_rank&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="n">reacs_rank</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">current_sorted_allreacs_tuple_list</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="si">{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">)</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reacs_rank</span><span class="p">)):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;substep = </span><span class="si">{}</span><span class="s1"> | dens = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">nucl</span><span class="o">.</span><span class="n">get_current_dens_subseq</span><span class="p">()[</span><span class="n">ss</span><span class="p">])</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reacs_rank</span><span class="p">[</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_print_summary_allreacs_rank</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summary_path</span><span class="p">):</span>

        <span class="n">passport_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">passport_list</span>
        <span class="n">cell_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="n">file_name</span> <span class="o">=</span> <span class="n">summary_path</span> <span class="o">+</span><span class="s1">&#39;/cell_</span><span class="si">{}</span><span class="s1">_reacs_rank&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>

        <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">nucl</span> <span class="ow">in</span> <span class="n">passport_list</span><span class="p">:</span>
            <span class="n">reacs_rank</span> <span class="o">=</span> <span class="n">nucl</span><span class="o">.</span><span class="n">sorted_allreacs_tuple_mat</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> ===</span><span class="si">{}</span><span class="s1">(</span><span class="si">{}</span><span class="s1">) ===</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nucl</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">nucl</span><span class="o">.</span><span class="n">zamid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reacs_rank</span><span class="p">)):</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">STEP </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">reacs_rank</span><span class="p">[</span><span class="n">s</span><span class="p">])):</span>
                    <span class="c1"># subseq has s+1 elements because of the initial element </span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;substep = </span><span class="si">{}</span><span class="s1"> | dens = </span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ss</span><span class="p">,</span> <span class="n">nucl</span><span class="o">.</span><span class="n">dens_subseq_mat</span><span class="p">[</span><span class="n">s</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="n">ss</span><span class="p">])</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reacs_rank</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">ss</span><span class="p">])</span>

        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># This is probably the method that generate the nuclide list that will then be used to produce reduced libraries</span>
    <span class="k">def</span> <span class="nf">_reduce_nucl_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_all_leaves</span><span class="p">()</span>
        <span class="n">total_leaves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_total_leaves</span>
        <span class="n">NAX_nucl_list</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">NAX_nucl_list</span>
        <span class="n">reduced_nucl_set</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">total_leaves</span><span class="o">+</span><span class="n">NAX_nucl_list</span><span class="p">))</span>
        <span class="n">ordered_reduced_set</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">order_nuclide_per_z</span><span class="p">(</span><span class="n">reduced_nucl_set</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_set_all_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_tree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_leaves</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fission_tree</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_fission_leaves</span><span class="p">()</span>
        <span class="n">run_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
        <span class="n">total_leaves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_leaves</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fission_leaves</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_total_leaves</span> <span class="o">=</span> <span class="n">total_leaves</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">get_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the generation tree for the BUCell. This returns a dictionnary where keys are the z-a-m id of initial nuclides of the BUCell. The entry for each initial nuclide is a list of generations. Each element of this list represents a generation of daughter nuclides (they are themselves lists of all the daughters from one generation).</span>

<span class="sd">        Daughters of generation n will be located in the nth list. There are separated by n-1 intermediate nuclides from the initial nuclide.</span>

<span class="sd">        This method is very useful to see which nuclides will be produced from an initial nuclide. It requires, however, that nuclear data libraries are set to the BUCell (this can be a problem in coupled simulation as cross section data are only produced after OpenMC simulations).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#Old version nucl_set, not used anymore</span>
        <span class="c1">#nuc_list = self.nucl_set</span>

        <span class="n">nuc_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_nucl_list</span><span class="p">()</span>
        <span class="n">initial_nuc_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_nucl</span>
        <span class="c1"># print (nuc_list)</span>
        <span class="n">initial_nuc_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;922350&#39;</span><span class="p">,</span> <span class="s1">&#39;922380&#39;</span><span class="p">]</span>
        <span class="n">trees_dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">passdic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_get_zamid_passport_dict</span><span class="p">()</span>

        <span class="c1"># This list will dynamically store the remaining nuclide to allocate in the tree.</span>
        <span class="c1"># If a nuclide has already been put in the tree but there is a chain loop, because the nuclide will not appear anymore in this list</span>
        <span class="c1"># the infinite looping will be prevented</span>
        <span class="c1"># Here we remove the initial nuclides</span>
        <span class="c1">#reduced_nuc_list = [x for x in nuc_list if x not in initial_nuc_list]</span>
        <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nuc_list</span><span class="p">)</span>

        <span class="c1"># Initialize the dictionary where each entry is the name of the initial nuclide and the first element of the list is their direct child</span>
        <span class="k">for</span> <span class="n">nuc</span> <span class="ow">in</span> <span class="n">initial_nuc_list</span><span class="p">:</span>
            <span class="n">nuc_pass</span> <span class="o">=</span> <span class="n">passdic</span><span class="p">[</span><span class="n">nuc</span><span class="p">]</span>
            <span class="n">nuc_zamid</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">zamid</span>
            <span class="n">nuc_name</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">name</span>
            
            <span class="n">reduced_nuc_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nuc_zamid</span><span class="p">)</span>

            <span class="n">nuc_non0_child</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">get_all_non0_child</span><span class="p">()</span>
            <span class="n">nuc_child</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">nuc_non0_child</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">nuc_list</span><span class="p">))</span>
            <span class="n">trees_dic</span><span class="p">[</span><span class="n">nuc_zamid</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">nuc_child</span><span class="p">]</span>

            <span class="n">reduced_nuc_list_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reduced_nuc_list</span><span class="p">)</span>
            <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reduced_nuc_list_copy</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nuc_child</span><span class="p">]</span>

            <span class="c1"># Build the tree for each initial nuclide</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">trees_dic</span><span class="p">[</span><span class="n">nuc_zamid</span><span class="p">]</span>

            <span class="n">end_of_tree</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">gen</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># As long as there are child that exists</span>
            <span class="k">while</span> <span class="n">end_of_tree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gen</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">next_child_gen</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">gen</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">parent_pass</span> <span class="o">=</span> <span class="n">passdic</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                    <span class="n">parent_child</span> <span class="o">=</span> <span class="n">parent_pass</span><span class="o">.</span><span class="n">get_all_non0_child</span><span class="p">()</span>

                    <span class="n">reduced_parent_child</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parent_child</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">reduced_nuc_list</span><span class="p">))</span>

                    <span class="n">reduced_nuc_list_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reduced_nuc_list</span><span class="p">)</span>
                    <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reduced_nuc_list_copy</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reduced_parent_child</span><span class="p">]</span>

                    <span class="n">next_child_gen</span> <span class="o">+=</span> <span class="n">reduced_parent_child</span>

                <span class="k">if</span> <span class="n">next_child_gen</span> <span class="o">==</span> <span class="p">[]:</span>
                    <span class="n">end_of_tree</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="c1">#reduced_nuc_list = </span>
                    <span class="k">break</span>

                <span class="n">tree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_child_gen</span><span class="p">)</span>

            <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nuc_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">trees_dic</span>

    <span class="k">def</span> <span class="nf">_set_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span>





    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaves</span>

    <span class="k">def</span> <span class="nf">_gen_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">tree_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span>

        <span class="n">conca_tree</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">initial_nuc</span> <span class="ow">in</span> <span class="n">tree_dic</span><span class="p">:</span>
            <span class="n">conca_tree</span> <span class="o">+=</span> <span class="p">[</span><span class="n">initial_nuc</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="n">tree_dic</span><span class="p">[</span><span class="n">initial_nuc</span><span class="p">]:</span>
                    <span class="n">conca_tree</span> <span class="o">+=</span> <span class="n">gen</span>

        <span class="c1"># Set is a set of unique element in the list. List convert that back into a new list</span>
        <span class="n">conca_tree_no_redundance</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">conca_tree</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">conca_tree_no_redundance</span>

    <span class="k">def</span> <span class="nf">_set_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_leaves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gen_leaves</span><span class="p">()</span>





<span class="c1"># This trees are the one built from the fissile nuclide through their fission products and their own trees</span>
<span class="c1"># This trees need the trees_dic from build tree to know which fissile nuclide are actually in the original tree (i.e. which </span>
<span class="c1"># fissile material have a chance to be created)</span>



    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fission_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fission_tree</span>

    <span class="k">def</span> <span class="nf">_gen_fission_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">passlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span>
        <span class="n">passdic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">passlist</span><span class="o">.</span><span class="n">_get_zamid_passport_dict</span><span class="p">()</span>
        <span class="n">initial_nuc_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initial_nucl</span>
        <span class="n">nuc_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nucl_set</span>
        <span class="n">leaves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_leaves</span>
        <span class="n">fy_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fy_parent_nucl</span><span class="p">()</span>
        <span class="n">fy_nucl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_fy_nucl</span><span class="p">()</span>
        <span class="n">fission_trees_dic</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">passlist</span><span class="o">.</span><span class="n">_set_fission_child</span><span class="p">(</span><span class="n">fy_nucl</span><span class="p">,</span> <span class="n">fy_parent</span><span class="p">)</span>

        <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nuc_list</span><span class="p">)</span>

        <span class="c1"># First we enter the initial nuc that are also fissile</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">fy_parent</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
                <span class="n">nuc_pass</span> <span class="o">=</span> <span class="n">passdic</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                <span class="n">nuc_zamid</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">zamid</span>

                <span class="n">reduced_nuc_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">nuc_zamid</span><span class="p">)</span>

                <span class="n">fission_child</span> <span class="o">=</span> <span class="n">nuc_pass</span><span class="o">.</span><span class="n">fission_child</span>

                <span class="n">reduced_fission_child</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fission_child</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">reduced_nuc_list</span><span class="p">))</span>

                <span class="n">fission_trees_dic</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">reduced_fission_child</span><span class="p">]</span>

                <span class="n">reduced_nuc_list_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reduced_nuc_list</span><span class="p">)</span>
                <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reduced_nuc_list_copy</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reduced_fission_child</span><span class="p">]</span>

            <span class="c1"># Then we build the tree from the fission products</span>
        <span class="c1">#   for initial_nuc in fission_trees_dic:</span>
                <span class="n">tree</span> <span class="o">=</span> <span class="n">fission_trees_dic</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                <span class="n">end_of_tree</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">gen</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># As long as there are child that exists</span>
                <span class="k">while</span> <span class="n">end_of_tree</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">gen</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">next_child_gen</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">[</span><span class="n">gen</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">parent_pass</span> <span class="o">=</span> <span class="n">passdic</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                        <span class="n">parent_child</span> <span class="o">=</span> <span class="n">parent_pass</span><span class="o">.</span><span class="n">get_all_non0_child</span><span class="p">()</span>

                        <span class="n">reduced_parent_child</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">parent_child</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">reduced_nuc_list</span><span class="p">))</span>

                        <span class="n">reduced_nuc_list_copy</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">reduced_nuc_list</span><span class="p">)</span>
                        <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">reduced_nuc_list_copy</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reduced_parent_child</span><span class="p">]</span>

                        <span class="n">next_child_gen</span> <span class="o">+=</span> <span class="n">reduced_parent_child</span>

                    <span class="k">if</span> <span class="n">next_child_gen</span> <span class="o">==</span> <span class="p">[]:</span>
                        <span class="n">end_of_tree</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="c1">#reduced_nuc_list = </span>
                        <span class="k">break</span>

                    <span class="n">tree</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">next_child_gen</span><span class="p">)</span>

                <span class="n">reduced_nuc_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">nuc_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fission_trees_dic</span>

    <span class="k">def</span> <span class="nf">_set_fission_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fission_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gen_fission_tree</span><span class="p">()</span>





    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fission_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fission_leaves</span>


    <span class="k">def</span> <span class="nf">_gen_fission_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">fission_tree_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fission_tree</span>

        <span class="n">conca_fission_tree</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">initial_nuc</span> <span class="ow">in</span> <span class="n">fission_tree_dic</span><span class="p">:</span>
            <span class="n">conca_fission_tree</span> <span class="o">+=</span> <span class="p">[</span><span class="n">initial_nuc</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">gen</span> <span class="ow">in</span> <span class="n">fission_tree_dic</span><span class="p">[</span><span class="n">initial_nuc</span><span class="p">]:</span>
                    <span class="n">conca_fission_tree</span> <span class="o">+=</span> <span class="n">gen</span>

        <span class="c1"># Set is a set of unique element in the list. List convert that back into a new list</span>
        <span class="n">conca_fission_tree_no_redundance</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">conca_fission_tree</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">conca_fission_tree_no_redundance</span>

    <span class="k">def</span> <span class="nf">_set_fission_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_fission_leaves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gen_fission_leaves</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_print_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;/tree_&amp;_leaves&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>

        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>

        <span class="n">tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tree</span>

        <span class="k">for</span> <span class="n">branch_zamid</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">:</span>

            <span class="n">branch_zamid_pass</span> <span class="o">=</span> <span class="n">pp</span><span class="p">(</span><span class="n">branch_zamid</span><span class="p">)</span>
            <span class="n">branch_name</span> <span class="o">=</span> <span class="n">branch_zamid_pass</span><span class="o">.</span><span class="n">name</span>
            <span class="n">branch_path</span> <span class="o">=</span> <span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_branch&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">branch_name</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">branch_zamid</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">leaves</span> <span class="ow">in</span> <span class="n">branch</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">leaves</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">branch_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">fission_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fission_tree</span>

        <span class="k">for</span> <span class="n">branch_zamid</span> <span class="ow">in</span> <span class="n">fission_tree</span><span class="p">:</span>

            <span class="n">branch_zamid_pass</span> <span class="o">=</span> <span class="n">pp</span><span class="p">(</span><span class="n">branch_zamid</span><span class="p">)</span>
            <span class="n">branch_name</span> <span class="o">=</span> <span class="n">branch_zamid_pass</span><span class="o">.</span><span class="n">name</span>

            <span class="n">branch_path</span> <span class="o">=</span> <span class="n">folder_path</span> <span class="o">+</span> <span class="s1">&#39;/</span><span class="si">{}</span><span class="s1">_fission_branch&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">branch_name</span><span class="p">)</span>
            <span class="n">txt</span> <span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="n">branch</span> <span class="o">=</span> <span class="n">fission_tree</span><span class="p">[</span><span class="n">branch_zamid</span><span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">leaves</span> <span class="ow">in</span> <span class="n">branch</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">leaves</span><span class="p">)</span>
                <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">branch_path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>




    <span class="k">def</span> <span class="nf">_gen_allreacs_ranking</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">allreacs_ranking</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">_gen_allreacs_dic</span><span class="p">()</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">folder_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_folder_path</span>

    <span class="c1"># Create a folder for the cell in the directory indicated in the argument</span>
    <span class="c1"># If no directory is passed as argument, the default directory is the current directory</span>

    <span class="c1"># Seems not used</span>
    <span class="c1"># def gen_folder(self):</span>

    <span class="c1">#     cell_name = self.name</span>

    <span class="c1">#     utils.gen_cell_folder(cell_name)</span>

    <span class="k">def</span> <span class="nf">_set_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">cell_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="n">utils</span><span class="o">.</span><span class="n">gen_cell_folder</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_folder_path</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_cell_folder_path</span><span class="p">(</span><span class="n">cell_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_copy_cell_folders_to_step_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>

        <span class="n">cell_folder_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_path</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">cell_folder_path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/step_</span><span class="si">{}</span><span class="s1">/</span><span class="si">{}</span><span class="s1">_cell&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">cell_folder_path</span><span class="p">)</span></div>

    <span class="c1"># def _gen_output_summary_folder(self):</span>

    <span class="c1">#   name = &#39;output_summary&#39;</span>
    <span class="c1">#   self._output_summary_path = utils.get_folder_path(name)</span>
    <span class="c1">#   utils.gen_folder(name)</span>


<span class="k">class</span> <span class="nc">Initial_nucl_not_set</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise when the user forgot to set the initial nuclide of the cell and tries to burn cell&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Nucl_set_not_in_Lib_nucl</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise when the user forgot to set the initial nuclide of the cell and tries to burn cell&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Initial_nucl_not_in_Nucl_set</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise when the user forgot to set the initial nuclide of the cell and tries to burn cell&quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Nuclide_list_redundant</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>

    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Passlist_not_defined</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Raise when the user forgot to defined passlist for a cell&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Julien de Troullioud de Lanversin

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-30411614-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>


</body>
</html>